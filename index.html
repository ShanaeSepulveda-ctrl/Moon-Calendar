<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>The Ancestral Moon Map | V71 Divine Depth</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Charm:wght@400;700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
  <style>
    :root { 
      --space: #020105; --gold: #e6ccff; --glass: rgba(12, 6, 24, 0.96); 
      --blood: #ff3385; --aura: #9d50bb; --amethyst: #df80ff;
      --retro: #ff6b6b; --portal: #ffd700; --moon-glow: #a8e6cf; --zodiac: #99ccff; --phase: #b388ff;
    }
    body { 
      font-family: 'Quicksand', sans-serif; background: var(--space); 
      background-image: radial-gradient(circle at top, #1a0b2e 0%, var(--space) 100%); 
      color: #fdfbff; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden;
    }
    .star-field { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) infinite ease-in-out; }
    @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }

    #oracleDash, #grimoireView, #yearlyView { 
      width: 92%; max-width: 450px; background: var(--glass); backdrop-filter: blur(30px); 
      border: 1px solid rgba(230, 204, 255, 0.1); border-top: 3px solid var(--aura); 
      border-radius: 35px; padding: 20px; margin: 15px 0; box-shadow: 0 15px 50px rgba(0,0,0,0.9); text-align: center; display: none; position: relative;
    }
    #oracleDash { display: block; }

    #cosmicModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background: rgba(15, 5, 25, 0.98); border: 2px solid var(--gold); border-radius: 25px; padding: 25px; z-index: 1000; text-align: center; box-shadow: 0 0 50px rgba(200, 180, 255, 0.3); }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; }

    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 450px; margin-bottom: 10px; }
    .day-label { font-size: 0.55rem; color: var(--gold); font-family: 'Cinzel'; opacity: 0.6; }
    .day { background: rgba(255,255,255,0.02); border-radius: 10px; aspect-ratio: 1/1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 1.5px solid transparent; cursor: pointer; transition: 0.3s; }
    
    .day.today { border: 2.5px solid var(--gold); box-shadow: 0 0 15px var(--gold); z-index: 2; }
    .day.full-moon-day { background: radial-gradient(circle, rgba(230, 204, 255, 0.3) 0%, transparent 70%); }
    .day.new-moon-day { background: radial-gradient(circle, rgba(75, 0, 130, 0.4) 0%, transparent 70%); }
    .day.celestial-pivot { border: 1.5px dashed var(--gold); }
    .day.selected { border: 1px solid #fff; background: rgba(255, 255, 255, 0.1); }
    .day.period { border-bottom: 3px solid var(--blood) !important; }

    .d-num { position: absolute; top: 4px; left: 6px; font-size: 0.55rem; opacity: 0.4; }
    .t-num { position: absolute; top: 4px; right: 6px; font-size: 0.55rem; color: var(--gold); font-weight: bold; }
    .m-ico { font-size: 1rem; margin-top: 5px; filter: drop-shadow(0 0 5px var(--aura)); }
    .z-ico { font-size: 0.45rem; color: var(--gold); margin-top: 2px; font-family: 'Cinzel'; }

    .nav-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--gold); border-radius: 15px; padding: 8px 12px; font-family: 'Cinzel'; font-size: 0.6rem; margin: 5px; }
    .cycle-btn { border: 1.5px solid var(--blood); color: var(--blood); background: transparent; padding: 14px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.8rem; width: 100%; margin-top: 15px; transition: 0.3s; }
    .cycle-btn.active { background: var(--blood); color: white; box-shadow: 0 0 15px var(--blood); }
    .sister-btn { background: rgba(255,255,255,0.05); color: var(--gold); border: 1px solid var(--aura); padding: 10px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.65rem; width: 100%; margin-top: 10px; }
    .explore-btn { background: var(--gold); color: var(--space); border: none; padding: 10px 25px; border-radius: 20px; font-family: 'Cinzel'; font-size: 0.75rem; margin-top: 15px; cursor: pointer; text-decoration: none; display: inline-block; box-shadow: 0 0 15px var(--gold); }

    .wisdom-card { text-align: left; background: rgba(0,0,0,0.4); padding: 20px; border-radius: 25px; border-left: 3px solid var(--aura); margin-bottom: 15px; }
    .wisdom-label { font-family: 'Cinzel'; font-size: 0.6rem; color: var(--gold); letter-spacing: 2px; display: block; margin-bottom: 8px; }
    .wisdom-text { font-family: 'Charm'; font-size: 1.15rem; line-height: 1.6; color: #eee; }
    .affirmation { font-family: 'Cinzel'; font-size: 0.7rem; color: var(--gold); margin-top: 12px; opacity: 0.8; font-style: italic; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px;}
    
    .energy-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .energy-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 8px; flex: 1; margin: 0 3px; cursor: pointer; font-size: 1.2rem; transition: 0.3s; }
    .energy-btn.active { background: var(--aura); border-color: var(--gold); box-shadow: 0 0 10px var(--aura); transform: scale(1.1); }
    .energy-label { font-family: 'Cinzel'; font-size: 0.55rem; color: var(--gold); margin-bottom: 15px; height: 10px; letter-spacing: 1px; }

    #journalInput { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; color: #fff; font-family: 'Charm'; font-size: 1.2rem; min-height: 100px; box-sizing: border-box; outline: none; }
    
    .event-badge { font-size: 0.6rem; padding: 4px 12px; border-radius: 15px; display: inline-block; margin-bottom: 5px; font-family: 'Cinzel'; letter-spacing: 1px; cursor: pointer; }
    .portal-badge { background: var(--portal); color: var(--space); box-shadow: 0 0 10px var(--portal); }
    .retro-badge { background: var(--retro); color: var(--space); box-shadow: 0 0 10px var(--retro); }
    .moon-badge { background: var(--moon-glow); color: var(--space); box-shadow: 0 0 10px var(--moon-glow); }
    .zodiac-badge { background: var(--zodiac); color: var(--space); box-shadow: 0 0 10px var(--zodiac); }
    .phase-badge { background: var(--phase); color: var(--space); box-shadow: 0 0 10px var(--phase); }
    .newyear-badge { background: linear-gradient(90deg, #2ecc71, #df80ff); color: white; box-shadow: 0 0 20px #2ecc71; padding: 8px 20px; font-size: 0.75rem; border: 1px solid white; cursor: pointer;}
    
    .grim-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px; }
    .grim-btn { background: transparent; border: none; color: #aaa; font-size: 0.9rem; cursor: pointer; }
    .support-link { margin-top: 20px; font-size: 0.7rem; color: var(--gold); opacity: 0.7; cursor: pointer; text-decoration: underline; font-family: 'Cinzel'; display: block; }
    
    /* Backup Controls */
    .backup-section { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px; padding-top: 20px; }
    .backup-title { font-family: 'Cinzel'; font-size: 0.7rem; color: var(--gold); margin-bottom: 10px; display:block;}
    .backup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .backup-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--gold); padding: 10px; border-radius: 10px; font-family: 'Cinzel'; font-size: 0.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
    .backup-btn:hover { background: rgba(255,255,255,0.1); }
    .export-btn { background: var(--aura); border: none; color: white; grid-column: span 2; }
  </style>
</head>
<body>

<div class="star-field" id="starField"></div>

<div style="display: flex; justify-content: space-between; width: 92%; max-width: 450px;">
  <button class="nav-btn" onclick="showView('yearly')">YEARLY MAP</button>
  <button class="nav-btn" onclick="showView('grimoire')">MY HISTORY</button>
</div>

<div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 450px; margin: 10px 0;">
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(-1)">‚òæ</span>
  <h3 id="monthLabel" style="font-family:'Cinzel'; letter-spacing: 4px; margin:0; font-size: 1rem;"></h3>
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(1)">‚òΩ</span>
</div>

<div id="calendar"></div>

<div id="oracleDash">
  <div id="eventDisplay"></div>
  <div id="elementTag" style="font-size: 0.5rem; letter-spacing: 1.5px; color: var(--aura); font-weight: bold; margin-bottom: 5px;"></div>
  
  <span id="detailedPhase" style="font-family: 'Cinzel'; font-size: 0.75rem; color: var(--gold); opacity: 0.9; letter-spacing: 3px; font-weight: bold;"></span>
  <h2 id="dashTitle" style="font-family:'Cinzel'; margin: 5px 0; color:var(--gold); letter-spacing: 3px; font-size: 1.3rem;"></h2>
  <div id="dashSub" style="font-size: 0.6rem; letter-spacing: 2px; margin-bottom: 20px; opacity: 0.8; font-family: 'Cinzel';"></div>
  
  <div class="wisdom-card">
    <span class="wisdom-label">ANCESTRAL WHISPER</span>
    <div class="wisdom-text" id="guidanceText"></div>
    <div class="affirmation" id="affirmationText"></div>
  </div>

  <div class="wisdom-card" id="shadowCard" style="display:none; border-left: 3px solid var(--retro);">
    <span class="wisdom-label" style="color:var(--retro);">SHADOW WORK INQUIRY</span>
    <div class="wisdom-text" id="shadowText"></div>
  </div>

  <div class="wisdom-card">
    <span class="wisdom-label">SACRED EARTH RITUAL</span>
    <div class="wisdom-text" id="ritualText"></div>
  </div>

  <div class="energy-row">
    <div class="energy-btn" onclick="setEnergy('üî•')" id="e-fire">üî•</div>
    <div class="energy-btn" onclick="setEnergy('üíß')" id="e-water">üíß</div>
    <div class="energy-btn" onclick="setEnergy('üå¨Ô∏è')" id="e-air">üå¨Ô∏è</div>
    <div class="energy-btn" onclick="setEnergy('ü™®')" id="e-earth">ü™®</div>
  </div>
  <div id="energyLabel" class="energy-label">Select your dominant energy</div>

  <textarea id="journalInput" placeholder="Scribe your soul's journey..." oninput="saveData()"></textarea>
  
  <div style="display: flex; flex-direction: column; gap: 5px;">
    <button id="flowBtn" class="cycle-btn" onclick="toggleFlow()">MARK MOON FLOW</button>
    <button class="sister-btn" onclick="copySisterReport()">
      <span>‚ú®</span> SHARE SISTER REPORT <span>‚ú®</span>
    </button>
  </div>
</div>

<div class="modal-overlay" onclick="closeModal()"></div>
<div id="cosmicModal">
  <h2 id="modalTitle" style="font-family:'Cinzel'; color:var(--gold);"></h2>
  <div id="modalText" style="font-family:'Charm'; font-size:1.1rem; color:#fff; margin:20px 0;"></div>
  <div id="sunMoonDistinction" style="font-size: 0.7rem; color: var(--zodiac); border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; margin-top: 10px; font-family: 'Quicksand'; font-style: italic; display:none;">
    Note: The Sun Sign is your external Season. This tracks your Moon Sign‚Äîyour internal emotional tide.
  </div>
  <a id="modalLink" href="#" target="_blank" class="explore-btn">EXPLORE DEEPER</a>
</div>

<div id="grimoireView">
  <span style="float:right; cursor:pointer;" onclick="showView('dash')">‚úï</span>
  <h2 style="font-family:'Cinzel';">MY SACRED HISTORY</h2>
  <div style="font-size:0.6rem; margin-bottom:10px; opacity:0.6;">Your journey is sacred. Export to view your patterns.</div>
  
  <div class="backup-section">
    <span class="backup-title">DATA MANAGEMENT</span>
    <div class="backup-grid">
        <button class="backup-btn export-btn" onclick="exportToCSV()">üìä EXPORT SPREADSHEET (READABLE)</button>
        <button class="backup-btn" onclick="backupData()">‚¨áÔ∏è BACKUP (FILE)</button>
        <button class="backup-btn" onclick="document.getElementById('restoreInput').click()">‚¨ÜÔ∏è RESTORE</button>
    </div>
    <input type="file" id="restoreInput" style="display:none" onchange="restoreData(this)">
  </div>
  
  <div id="grimoireContent" style="max-height: 350px; overflow-y: auto; margin-top: 15px;"></div>
  <a class="support-link" href="https://ko-fi.com/theancientrhythm" target="_blank">Created with Love ‚Ä¢ Support the Journey</a>
</div>

<div id="yearlyView">
  <span style="float:right; cursor:pointer;" onclick="showView('dash')">‚úï</span>
  <h2 style="font-family:'Cinzel'; font-size: 1rem;">CELESTIAL TIMELINE</h2>
  <div id="yearlyContent" style="text-align: left; padding: 10px; font-size: 0.75rem;"></div>
</div>

<script>
  let activeD = new Date(2026, 0, 16); 
  let selectedDate = new Date().toDateString();
  let db = JSON.parse(localStorage.getItem('ancestral_moon_v71')) || { logs: {}, journals: {}, zodCache: {}, energy: {} };

  const ELEMENTS = { "FIRE": "#ff4d4d", "EARTH": "#2ecc71", "AIR": "#3498db", "WATER": "#df80ff" };
  const ZOD_ELEMENTS = { "Aries ‚ôà":"FIRE", "Leo ‚ôå":"FIRE", "Sagittarius ‚ôê":"FIRE", "Taurus ‚ôâ":"EARTH", "Virgo ‚ôç":"EARTH", "Capricorn ‚ôë":"EARTH", "Gemini ‚ôä":"AIR", "Libra ‚ôé":"AIR", "Aquarius ‚ôí":"AIR", "Cancer ‚ôã":"WATER", "Scorpio ‚ôè":"WATER", "Pisces ‚ôì":"WATER" };
  
  // üìö V71 THE DIVINE LIBRARY (Deep, Poetic, Expanded)
  const DAILY_WISDOM_LIBRARY = {
    "Aries": { 
      "Waxing": [
        "The spark of creation has caught in the dry grass of your soul. Do not fear the heat; fan this flame with bold action, for what burns now clears the path for the new world you are building.", 
        "The ancestors whisper of courage today. You are being asked to step into the arena of your life not as a spectator, but as the warrior who knows that hesitation is the only true defeat.", 
        "Initiation requires a first step that feels like jumping off a cliff. The waxing fire supports this leap. Trust that your wings will open the moment you decide to fly."
      ], 
      "Waning": [
        "The warrior lays down the sword. Release the anger that has protected you but now only weighs you down. Let the fire burn down to warm embers that comfort rather than consume.", 
        "Reflect on the battles you have fought this cycle. Honor your scars as maps of where you have been, but do not carry the war into the time of rest. Peace is also a victory.", 
        "Shed the need to be first, to be right, or to be seen. There is profound wisdom in the pause between heartbeats. Let your fire turn inward to illuminate your own shadows."
      ], 
      "Full": [
        "Your passion is a beacon on the mountaintop. Do not dim your light to make others comfortable. You are asked to occupy your full radiance without apology or hesitation.", 
        "Stand tall and declare your sovereignty to the cosmos. You are the architect of your fate, and the fire in your belly is the fuel for your empire. Own your power completely.", 
        "The warrior stands in the full light of day. Celebrate the victories, however small, that have brought you to this moment. Your endurance is your crown."
      ], 
      "New": [
        "In the velvet dark, a seed of fire waits to be struck. You are in the void of potential. Do not rush the sunrise; gather your strength in the silence before the strike.", 
        "Dream of a new conquest, not of lands, but of self-mastery. The Aries new moon asks you to define who you are becoming when the world isn't watching.", 
        "Silence before the thunder. Gather your energy, conserve your heat, and prepare your will. A great cycle of action is beginning, but tonight, we rest in the potential."
      ] 
    },
    "Taurus": { 
      "Waxing": [
        "Build slowly, for you are building a cathedral, not a tent. Lay one brick at a time with absolute love and presence. The ancestors honor the slow hand that creates lasting beauty.", 
        "Nourish the seed of your intention. Attend to your physical body as the holy vessel it is. Eat rooted foods, drink deep waters, and remember that your spirit needs a sturdy home.", 
        "Ground your intentions into the tangible world. Do not just dream it; make it real. Write it down, touch the earth, and solidify your vision with the weight of stone."
      ], 
      "Waning": [
        "Release the physical clutter that chokes your space. Return what you do not need to the soil or to others. You cannot receive the new harvest if your hands are full of yesterday.", 
        "Compost the excess. Taurus asks you to find value in simplicity. Strip away the ornate layers until you find the solid, unshakeable core of your truth.", 
        "Let go of stubbornness. Like the earth, allow yourself to be reshaped by the seasons. To yield is not to break; it is to trust the wisdom of the cycle."
      ], 
      "Full": [
        "A harvest of pleasure is yours. Celebrate the abundance that is already in your hands. Do not look for what is missing; revel in the golden weight of what is present.", 
        "Honor the body with touch, scent, and taste. Your senses are the gates to the divine. Worship your own existence by deeply enjoying the simple gifts of being alive.", 
        "Manifestation in form. What you have built is solid and real. Stand on the firm ground of your achievements and feel the support of the earth beneath you."
      ], 
      "New": [
        "Plant deep. The soil is rich, dark, and ready. Do not sow seeds of fear; sow seeds of peace, security, and long-term worth. What you plant now will outlast you.", 
        "Set intentions for peace that settles in the bones. Call in the silence of the deep forest. You are safe to rest here, held by gravity and grace.", 
        "Rest in the earth's embrace. You do not need to strive or push. Like a stone in a river, let the world flow around you while you remain centered and still."
      ] 
    },
    "Gemini": { 
      "Waxing": [
        "Speak your truth, for words are spells. The waxing moon carries your voice on the wind to the corners of your life where it is needed most. Do not silence your song.", 
        "Connect the dots. Your mind is weaving a new story for your life, stitching together ideas that seem separate. Trust the curiosity that pulls you in a new direction.", 
        "Curiosity is the key that unlocks the stagnant doors. Follow the thread of interest, no matter how thin, for it leads to a tapestry of wisdom you cannot yet see."
      ], 
      "Waning": [
        "Quiet the mind. The winds are spinning too fast; release the thoughts that circle like vultures. Let them fly away so you can hear the whisper of your own heart.", 
        "Unlearn. Let go of the old narratives that keep you small. You are not who you were told you are. You are the storyteller, and you can edit the script.", 
        "The wind settles. Find the profound silence between the words. In the gap between thoughts, the truth of your spirit is waiting to be heard."
      ], 
      "Full": [
        "Illuminate the mind. A flash of clarity pierces the fog. You see the whole picture now, the intricate web of connections. Do not look away from the truth.", 
        "The conversation is open between you and the cosmos. Speak clearly your desires, and listen deeply for the reply. Your voice is a vibration that shapes reality.", 
        "A whirlwind of connection. Share your light with your community. You are a messenger, and your joy is the message. Spread it like pollen on the breeze."
      ], 
      "New": [
        "Plant a thought-form in the fertile silence. The air is still and ready for a new word. What spell will you cast with your intention today?", 
        "Set an intention for your voice. Where have you been silent? Where have you swallowed your truth? Resolve to speak, even if your voice shakes.", 
        "A blank page lies before you. The Gemini new moon hands you the quill. Write the first line of the new chapter with courage and wit."
      ] 
    },
    "Cancer": { 
      "Waxing": [
        "Nurture the dream as you would a tender child. Protect your growing intentions from the harsh winds of criticism. You grow best when you feel safe and held.", 
        "Flow with the rising tide. Your emotional guidance system is calibrating. Trust the feelings that surface; they are not distractions, they are the compass.", 
        "Build a shell of safety. It is not weak to need sanctuary. Create a space where your softest self can breathe without fear of being bruised."
      ], 
      "Waning": [
        "Release the emotional weight you carry for others. The tears you cry are holy water, cleansing the temple of your soul. Let them fall freely.", 
        "Let the tide go out. Forgive the past, not for them, but to unchain your own ankle. You cannot swim freely if you are dragging the wreckage of yesterday.", 
        "Return to the source. The waters are receding to reveal the truth on the ocean floor. Look at what remains when the emotion settles. That is your core."
      ], 
      "Full": [
        "Overflowing heart. Let your emotions spill over the edges; they are valid and holy. You are a vessel of deep feeling, and that is your superpower, not your flaw.", 
        "The Mother shines through you. Honor your lineage, the women who came before, and the mother within yourself. You are the keeper of the ancient flame.", 
        "A high tide of intuition. You know things you cannot explain. Trust this knowing. It is the whisper of the water, ancient and unfailingly true."
      ], 
      "New": [
        "The womb of the world is dark and fluid. Rest in these waters of creation. You do not need to be solid right now; you only need to be receptive.", 
        "Plant love in the center of your home. Set an intention to make your life a sanctuary. Where there is love, there is growth.", 
        "Retreat inward. The crab finds safety in the sand to dream. Allow yourself to hide from the world so you can be found by your own spirit."
      ] 
    },
    "Leo": { 
      "Waxing": [
        "Shine. The world does not serve from your shrinking. Like the sun climbing the sky, you are asked to occupy your full radiance without apology.", 
        "Create. Leo energy demands that you express your unique soul. Paint, dance, write, or build‚Äînot for the outcome, but for the sheer joy of the act.", 
        "Play. Approach your goals with the lightness of a child. Seriousness is a heavy coat; take it off and run freely into the direction of your joy."
      ], 
      "Waning": [
        "Release the need for applause. Your worth is not determined by how many eyes are watching. Find the glow that comes from within, independent of praise.", 
        "Let the ego rest. The sun sets so the stars can shine. Step back from the center stage and find the quiet dignity of simply being.", 
        "Shed the performance. Who are you when no one is watching? Strip away the masks until you find the face that was yours before the world told you who to be."
      ], 
      "Full": [
        "Radiance. You are the sun center of your own universe today. Burn bright, not to blind others, but to warm them. Your joy is a healing frequency.", 
        "Heart-centered power. Lead with love and others will follow naturally. The true king or queen rules not by force, but by the size of their heart.", 
        "Celebrate yourself. It is not vanity; it is recognizing the divine spark that lives in your chest. Honor the miracle of your own existence."
      ], 
      "New": [
        "A seed of creativity lies in the dark. What art waits in the shadows to be born? What song is humming in your blood, waiting for a voice?", 
        "Set an intention for joy. Where have you become too rigid? Where do you need more play? Invite the inner child to the altar.", 
        "The heart's desire. Listen to the steady beat of your own truth. It is drumming a rhythm that is uniquely yours. Follow it."
      ] 
    },
    "Virgo": { 
      "Waxing": [
        "Refine the plan. The divine is found in the details. Do not rush; the magic is in the mindful placement of each step. You are weaving a masterpiece.", 
        "Attend to the daily rituals. Small steps, taken with great love, lead to the summit. Your routine is your prayer; make it sacred.", 
        "Purify your intent. Virgo asks for clarity and service. Ask yourself: Does this serve my highest good? If not, prune it away to make room for growth."
      ], 
      "Waning": [
        "Cleanse. Sweep the mental and physical dust away. A clear space leads to a clear mind. Release the chaos to find the calm center.", 
        "Release perfectionism. It is a shield that keeps you from connecting. You are enough exactly as you are, messy and human and holy.", 
        "Analyze what worked and let go of what failed. Do not carry the guilt of mistakes; carry only the wisdom they taught you."
      ], 
      "Full": [
        "The priestess stands tall. Your service is your magic. How you help others is how you heal yourself. Stand in the dignity of your work.", 
        "Order from chaos. See the pattern in the weaving. The universe is not random; it is an intricate design, and you are a vital thread.", 
        "Healing light. Focus on the wholeness of the body. Treat your physical form with reverence; it is the only house your soul will ever own."
      ], 
      "New": [
        "Plant a seed of order. Organize your inner world so that the outer world can reflect it. Peace begins in the quiet mind.", 
        "Set an intention for health. Your body is the vessel for your magic. Ask it what it needs, and promise to listen.", 
        "Quiet service. How can you serve your soul in the dark? Tend to your own garden before you try to feed the world."
      ] 
    },
    "Libra": { 
      "Waxing": [
        "Balance the scales. Move forward with grace and diplomacy. You are the mediator between your dreams and your reality. Find the middle way.", 
        "Beautify your path. Libra asks you to find the art in the journey. If it does not bring you beauty or peace, ask yourself why you are carrying it.", 
        "Connect. Partnership aids your growth right now. You do not have to do this alone; reach out and find the hand that fits yours."
      ], 
      "Waning": [
        "Release the need to please. Harmony starts within. You cannot set yourself on fire to keep others warm. Reclaim your own energy.", 
        "Let go of indecision. Trust the choice you made. Standing at the crossroads only delays the journey. Pick a path and walk it with conviction.", 
        "Unbind yourself from the expectations of others. Their disappointment is not your burden to carry. Be true to your own soul first."
      ], 
      "Full": [
        "Mirror magic. The world reflects your internal state. Look at your relationships as mirrors; what are they showing you about yourself?", 
        "A climax of beauty. Surround yourself with what you love. Let art, music, and softness be your armor against the hardness of the world.", 
        "Justice and harmony. Seek the middle path in the full light. Where there has been conflict, bring the balm of understanding."
      ], 
      "New": [
        "Set an intention for peace. Where is the war in your life? Call a ceasefire and invite tranquility to sit at your table.", 
        "Sow seeds of partnership. Call in your divine mirrors, the people who will reflect your light back to you.", 
        "Rest in equilibrium. The scales are still. In this balance, you can find the center point from which all action flows."
      ] 
    },
    "Scorpio": { 
      "Waxing": [
        "Dive deep. The surface is not where the treasure lies. You are being called to the depths of your own psyche. Do not fear what swims there.", 
        "Invest your energy. Scorpio asks for total commitment. Do not dabble; immerse yourself. Transformation requires your whole heart.", 
        "Trust your gut. The mystery is unfolding, and your intuition is the only map you need. Close your eyes to see more clearly."
      ], 
      "Waning": [
        "Shed the skin. Transformation requires letting go of the old form. It may feel raw, but the new skin is growing underneath. Trust the process.", 
        "Release the grudge. Poison only hurts the vessel that holds it. Let go of the desire for revenge and find the freedom of indifference.", 
        "The compost of the soul. Let the dead leaves of your past feed the roots of your future. Nothing is wasted; everything is transformed."
      ], 
      "Full": [
        "The Phoenix rises. A powerful time for rebirth and revelation. You are not who you were yesterday. Step out of the ashes and fly.", 
        "Secrets revealed. Look at the shadow with compassion. What you hide holds power over you; bring it into the light and it dissolves.", 
        "Intense magic. Your power is potent; use it wisely. Your gaze can heal or harm today. Choose to heal."
      ], 
      "New": [
        "The void. Sit in the absolute dark and do not be afraid. In this darkness, you are unmaking yourself so you can be remade.", 
        "Set an intention for transformation. What must die to be born? Offer it up to the dark mother and trust she will hold you.", 
        "Plant a secret. Keep your magic hidden while it germinates. Power grows in silence. Tell no one your wish."
      ] 
    },
    "Sagittarius": { 
      "Waxing": [
        "Aim high. The arrow flies further than you think. Do not limit your vision to what is practical; dream of what is possible.", 
        "Explore. Say yes to the adventure calling your name. The comfort zone is a beautiful place, but nothing grows there.", 
        "Expand your vision. Look beyond the horizon. The ancestors are widening your path; walk it with a stride of freedom."
      ], 
      "Waning": [
        "Release the dogma. Let go of the need to be 'right' to find what is true. Wisdom is fluid, not fixed.", 
        "Simplify the quest. You are carrying too much baggage for this journey. Carry only what you need: your truth and your hope.", 
        "The wanderer rests. Find wisdom in the stillness. You do not need to seek answers out there; they are already written in your bones."
      ], 
      "Full": [
        "The truth illuminates. You can see the big picture clearly now. The details fade, revealing the grand design of your life.", 
        "Wild celebration. Dance with the cosmos tonight. Your spirit is vast, wild, and free. Let it take up the space it deserves.", 
        "The teacher speaks. Share your wisdom with the world. Your story is the medicine someone else needs to hear."
      ], 
      "New": [
        "Plant a seed of freedom. Where do you want to roam? What chains are you ready to break? The open road waits.", 
        "Set an intention for truth. Seek the philosophy that frees you. Ask the big questions and listen for the whispers.", 
        "The dark horizon. Trust that the path is there even if you cannot see it. Your faith is the lantern."
      ] 
    },
    "Capricorn": { 
      "Waxing": [
        "Climb. The mountain is steep, but your legs are strong. Capricorn energy rewards discipline. Keep going; the view is worth it.", 
        "Commit. You are building a legacy. Do not look for shortcuts; look for the stones that will stand for a hundred years.", 
        "Build the legacy. Every stone matters. Work with integrity and patience. You are the architect of your own destiny."
      ], 
      "Waning": [
        "Release the burden. You do not have to carry the weight of the world. Put the pack down and rest your shoulders.", 
        "Let go of the rigid plan. The mountain path twists; do not try to walk a straight line. Flow around the obstacle like water.", 
        "The Elder rests. Wisdom comes from silence, not just work. Sit and watch the world turn without trying to control it."
      ], 
      "Full": [
        "The summit. Look at how far you have come. Acknowledge your hard work and the strength it took to get here.", 
        "Power manifested. Own your authority in this life. You are the CEO of your soul. Lead with wisdom.", 
        "Structure and light. Your foundations are illuminated. See where you are strong and give thanks for the ground beneath you."
      ], 
      "New": [
        "Blueprint in the dark. Plan the empire you wish to build. In the silence, the structure of the future is revealed.", 
        "Set an intention for purpose. What is your Great Work? What will you leave behind for the ones who come after?", 
        "Ground your ambition. Root it in the earth before you try to climb. A tree with no roots cannot reach the sky."
      ] 
    },
    "Aquarius": { 
      "Waxing": [
        "Innovate. Try a new way of doing the old thing. The ancestors applaud your ingenuity. Break the rules that no longer work.", 
        "Connect with the web. Your vibration affects the collective. Send out a frequency of hope and watch it ripple back.", 
        "Break the mold. Freedom is your fuel. Do not fit into the box they made for you; burn the box and use the light."
      ], 
      "Waning": [
        "Release the detachment. Come back to your heart. It is safe to feel deeply and to be connected to humanity.", 
        "Let go of the need to be different. Just be. You are unique simply because you exist; you do not need to prove it.", 
        "Clear the static. Tune your frequency to a clearer channel. The noise of the world is loud; find the signal of your soul."
      ], 
      "Full": [
        "Cosmic connection. You are a star in a vast constellation. Feel the threads of light connecting you to every living thing.", 
        "The Rebel shines. Stand for what you believe in, even if you stand alone. Your authenticity is a revolution.", 
        "A vision of the future. See what is possible for humanity. Hold the torch high so others can see the way forward."
      ], 
      "New": [
        "Download the vision. The frequency is open for new ideas. Listen to the electric hum of the universe.", 
        "Set an intention for freedom. Where do you need space? Break the chains of convention in the dark.", 
        "Plant a seed for the collective. Dream not just for yourself, but for the world. We are all in this together."
      ] 
    },
    "Pisces": { 
      "Waxing": [
        "Dream. The veil is thin; listen to the whispers of the unseen. Your imagination is the workshop of your reality.", 
        "Flow. Do not push the river; float with it. Surrender your control and let the current take you to the holy water.", 
        "Create from the soul. Art is your prayer. Paint, sing, or dance your emotions out of your body and into the world."
      ], 
      "Waning": [
        "Dissolve. Let the boundaries melt away. You are not separate from the ocean; you are a drop returning to the source.", 
        "Release the illusion. Surrender to the great mystery. What you are losing is only the shell; the pearl remains.", 
        "Cleansing rain. Wash away the sorrow of the world. Let your tears join the waters of the earth in a sacred release."
      ], 
      "Full": [
        "Mystical union. You are one with the divine. The separation is an illusion. Feel the god-spark in your own chest.", 
        "The dreamer awakens. Intuition is at its peak. You know the truth without words. Trust the silent knowing.", 
        "Ocean of light. Bathe in the spiritual waters. Let the waves of cosmic love wash over you and heal every wound."
      ], 
      "New": [
        "The womb of the universe. Anything is possible in the void. Drift in the potential of the unmanifested.", 
        "Set an intention for spiritual connection. Pray. Speak to the ancestors and listen for their soft reply.", 
        "Drift in the silence. Let the current take you where you need to go. You do not need a map; you only need trust."
      ] 
    }
  };

  const DAILY_RITUALS = {
    "Aries": [
      "Light a red candle and stand before it. As you breathe, imagine you are inhaling the fire itself. Let it circulate through your blood, burning away fear, until you feel strong enough to take the first step.", 
      "Move your body vigorously for 5 minutes. Stomp your feet on the earth and shout if you need to. Shake the stagnation out of your limbs and reclaim the wild energy of your physical form.", 
      "Stand in the sun (or visualize it) and breathe in fire. Feel the solar plexus chakra ignite with golden light. Affirm: 'I am the driver of my destiny.'"
    ],
    "Taurus": [
      "Walk barefoot on the grass or soil. Feel the magnetic pull of the earth recharging your batteries. Imagine roots growing from your heels, anchoring you into deep, ancient safety.", 
      "Eat a piece of fruit slowly, savoring every bite. Let the sweetness be a prayer of gratitude. Remind your body that it is safe, it is fed, and it is loved.", 
      "Hold a smooth stone or crystal in your palm. Feel its weight and its age. Transfer your worries into the stone, knowing the earth can transmute them into peace."
    ],
    "Gemini": [
      "Write a letter to your future self. Tell her what you are learning today. Seal it and put it away. You are weaving a thread of connection across time.", 
      "Stand in the wind and whisper your wish. Let the breeze carry your words to the four corners of the earth. Trust that the air element is networking on your behalf.", 
      "Burn incense and watch the smoke dance. Let your gaze soften. As the smoke rises, imagine it carrying your busy thoughts away, leaving your mind clear and open."
    ],
    "Cancer": [
      "Take a ritual bath with salt and rose petals. As you submerge, imagine the water dissolving all emotional armor. Emerge soft, open, and cleansed.", 
      "Place a bowl of fresh water under the moon (or on a windowsill). Speak your love into the water. In the morning, use it to wash your face or water a plant.", 
      "Place your hand over your heart and breathe deeply. Visualize a silver light expanding from your chest, creating a bubble of safety around you. You are your own home."
    ],
    "Leo": [
      "Wear something gold or yellow today. Let it be a symbol of your inner royalty. Walk with your head high, imagining a crown of light resting on your brow.", 
      "Dance to your favorite song alone. Move without caring how it looks. Let the joy rise up from your hips and fill the room. You are celebrating your own aliveness.", 
      "Sun gaze safely at sunrise or sunset (when the light is soft). Drink in the golden light through your eyes and let it fill every cell with vitality and confidence."
    ],
    "Virgo": [
      "Clean one corner of your room mindfully. As you wipe away the dust, imagine you are clearing the cobwebs from your mind. Order in the home brings peace to the spirit.", 
      "Drink herbal tea with intention. Hold the cup, feel the warmth, and thank the plants for their medicine. Sip slowly, grounding yourself in the present moment.", 
      "Write a list of 3 things you are grateful for. Be specific. 'The way the light hits the floor.' 'The taste of coffee.' Sacredness is found in the smallest details."
    ],
    "Libra": [
      "Light two candles for balance. Sit between them and breathe. Visualize your left side and right side integrating, masculine and feminine coming into perfect union.", 
      "Place fresh flowers or something beautiful on your altar. Beauty is a high vibration. Let your eyes rest on it and feel your spirit lift to match its frequency.", 
      "Meditate on the sound of a bell or chime. Listen to the note until it fades completely into silence. In that silence, find your center point."
    ],
    "Scorpio": [
      "Sit in total darkness and silence. Do not try to fill the void. Let the darkness hold you. In this space, you are hidden, protected, and powerful.", 
      "Write a fear or a secret on a piece of paper. Safely burn it in a fireproof bowl. Watch it turn to ash and declare: 'It no longer holds power over me.'", 
      "Scry in a bowl of dark water. Stare into the black reflection and ask your intuition to show you what you need to know. Trust the first image that comes."
    ],
    "Sagittarius": [
      "Walk in a new direction today. Take a route you have never taken. Invite the spirit of adventure into your mundane life. Keep your eyes open for signs.", 
      "Light a purple candle for wisdom. Sit and ask the ancestors to expand your vision. Imagine your mind growing vast, like the sky above the desert.", 
      "Look at the horizon and dream. If you can't see the horizon, visualize it. Feel the call of the distance. Remind yourself that your soul is limitless."
    ],
    "Capricorn": [
      "Stand like a mountain, feet wide, unmoving. Feel the ancient stability of the earth supporting you. You are unshakeable. You have weathered storms before.", 
      "Plant a seed in a small pot. Name the seed after a goal you have. Tend to it daily. As it roots, so does your ambition. Patience is the spell.", 
      "Hold a piece of quartz or river rock. Feel its cold, hard reality. Remind yourself that you are building something real. Structure is spiritual."
    ],
    "Aquarius": [
      "Meditate on the stars. If it is day, know they are there behind the blue. Feel your connection to the cosmic web. You are stardust made form.", 
      "Open a window and breathe fresh air. Let the wind circulate through your home. Visualize it sweeping away stale energy and bringing in new inspiration.", 
      "Visualize a web of light connecting you to every living being. Send a pulse of love down the web. Know that you are never truly alone."
    ],
    "Pisces": [
      "Listen to the sound of rain or ocean waves (use a recording if needed). Let the sound wash over you. Imagine you are floating, weightless and free.", 
      "Dip your feet in water (a bowl or a bath). Feel the coolness. Imagine the water drawing out all stress from your body and neutralizing it.", 
      "Sleep with a crystal (like amethyst or moonstone) under your pillow. Ask your guides to speak to you in the dreamtime. Keep a journal by your bed."
    ]
  };

  const PHASE_MEANINGS = {
    "New Moon": "The Void. A time of absolute potential. The slate is wiped clean. Plant seeds in the dark, set intentions, and rest. The energy is internal and quiet.",
    "Waxing Crescent": "The Sprout. The first sliver of light appears. Focus on strength, courage, and the initial push of action. Nurture the seed you planted.",
    "First Quarter": "The Root. Resistance meets action. You may face obstacles; this is the test of your commitment. Make decisions and push through.",
    "Waxing Gibbous": "The Bud. Refinement. The goal is in sight but not yet fully formed. Review your plans, tweak the details, and prepare for the bloom.",
    "Full Moon": "The Bloom. Peak energy and illumination. Everything is heightened. Celebrate what has come to fruition and see the truth clearly.",
    "Waning Gibbous": "The Fruit. Gratitude and sharing. The harvest is gathered. Share your wisdom and abundance with others. Reflect on the journey.",
    "Last Quarter": "The Compost. Release and forgiveness. The energy turns inward. Let go of what no longer serves you to make space for the new cycle.",
    "Waning Crescent": "The Seed. Surrender and rest. The moon is disappearing. Empty your cup. Rest deeply and wait for the new voice to speak.",
    "Moon": "The emotional tide of the soul. She governs the waters, the intuition, and the hidden self."
  };

  const SHADOW_WORK = {
    "Aries": "Where am I afraid to be weak? Does my anger protect a deeper hurt that needs tending?",
    "Taurus": "What comfort zone has become a cage? What am I hoarding out of fear of scarcity?",
    "Gemini": "What truth am I silencing to keep the peace? Where is my mind distracting my heart?",
    "Cancer": "What old wound am I nurturing instead of healing? Where do I need to mother myself?",
    "Leo": "Where do I seek validation from others instead of myself? What part of my light am I hiding?",
    "Virgo": "Where does my perfectionism stop me from living? What mess am I afraid to make?",
    "Libra": "Where am I compromising my soul to please another? What imbalance am I ignoring?",
    "Scorpio": "What secret am I keeping from myself? What needs to die so I can be reborn?",
    "Sagittarius": "What am I running away from? Does my quest for freedom hurt those I love?",
    "Capricorn": "Where have I let ambition silence my intuition? What burden is not mine to carry?",
    "Aquarius": "Where do I detach to avoid feeling? Am I observing life instead of living it?",
    "Pisces": "What reality am I escaping? Where do I need boundaries to protect my energy?"
  };

  const CELESTIAL_EVENTS = {
    "Feb 2": {n: "Imbolc Portal", d: "A sacred midpoint between Winter and Spring. The earth is stirring. Energy: Promise, Purification, First Light.", l: "spiritual meaning of imbolc"},
    "Aug 8": {n: "Lion's Gate Portal", d: "A massive alignment of Earth, Sirius, and the Sun. High-frequency light codes for ascension and bold manifestation.", l: "lions gate portal spiritual meaning"},
    "Nov 1": {n: "Samhain Portal", d: "The veil is thinnest. Ancestors are close. Energy: Commemorating the dead, Divination, Deep Roots.", l: "samhain spiritual significance"},
    "Feb 26": {n: "Mercury Retrograde Begins", d: "Communication turns inward. Do not fear; review. Energy: Reflection, Rewriting, Pausing.", l: "mercury retrograde spiritual meaning"},
    "Mar 20": {n: "Mercury Direct", d: "The shadow period clears. Move forward with the wisdom learned in the silence.", l: "mercury direct spiritual meaning"},
    "Jun 29": {n: "Mercury Retrograde Begins", d: "Thoughts turn nostalgic. Old friends may return. Energy: Reconnecting, Revisiting, Remembering.", l: "mercury retrograde in cancer spiritual meaning"},
    "Oct 21": {n: "Mercury Retrograde Begins", d: "Deep psychological review. Secrets are revealed for healing.", l: "mercury retrograde in scorpio spiritual meaning"},
    "Jan 1": {n: "Mars Retrograde", d: "Action turns passive. Anger requires understanding, not expression. Energy: Internal Drive, Patience.", l: "mars retrograde spiritual meaning"}
  };

  const PIVOTS = {
    "Mar 20": {n: "Spring Equinox", d: "The Ancestral New Year. Balance of day and night. Life bursts forth from the void. Energy: Rebirth, New Beginnings, Balance.", l: "spring equinox spiritual meaning"},
    "Jun 21": {n: "Summer Solstice", d: "The longest day. The sun is at its peak power. Celebrate the fullness of life. Energy: Vitality, Passion, Illumination.", l: "summer solstice spiritual meaning"},
    "Sep 22": {n: "Autumn Equinox", d: "The second harvest. Day and night equal again. We begin the descent into the inner world. Energy: Balance, Release, Gratitude.", l: "autumn equinox spiritual meaning"},
    "Dec 21": {n: "Winter Solstice", d: "The longest night. The return of the light. We honor the stillness and the spark in the dark. Energy: Rest, Hope, Rebirth.", l: "winter solstice spiritual meaning"}
  };

  const FULL_MOON_DATA = {
    "Jan 3": {n: "Wolf Moon", t: "Endurance", r: "Light a white candle. Stand in the cold air and hum your deepest truth. Imagine your voice joining the howl of your lineage.", l: "wolf moon spiritual meaning"},
    "Feb 1": {n: "Snow Moon", t: "Purity", r: "Gather clean snow or ice in a bowl. As it melts, whisper the fears you wish to dissolve. Pour the water into the earth.", l: "snow moon spiritual meaning"},
    "Mar 3": {n: "Worm Moon", t: "Awakening", r: "Stand barefoot on the earth or floor. Pulse your toes. Feel the vibration of the life force waking up beneath you.", l: "worm moon spiritual meaning"},
    "Apr 2": {n: "Pink Moon", t: "Emergence", r: "Dip a pink flower or stone in water. Anoint your heart and forehead. Declare: 'I am blooming without apology.'", l: "pink moon spiritual meaning"},
    "May 1": {n: "Flower Moon", t: "Potential", r: "Create a mandala of leaves and petals on the ground. Sit in the center and breathe in the abundance of the garden.", l: "flower moon spiritual meaning"},
    "May 31": {n: "Strawberry Moon", t: "Vitality", r: "Eat a sweet fruit mindfully. Feel the nectar as the physical manifestation of your own hard-earned sweetness.", l: "strawberry moon spiritual meaning"},
    "Jun 29": {n: "Buck Moon", t: "Abundance", r: "Stand tall, reaching arms high like antlers. Claim your space. Visualize your spirit connecting heaven and earth.", l: "buck moon spiritual meaning"},
    "Jul 29": {n: "Sturgeon Moon", t: "Power", r: "Submerge your hands in a bowl of water. Ask the ancient spirits of the deep for the resilience to swim against the current.", l: "sturgeon moon spiritual meaning"},
    "Aug 28": {n: "Harvest Moon", t: "Gratitude", r: "Hold a handful of grains or seeds. Name three things you have harvested this cycle. Offer the seeds to the birds or soil.", l: "harvest moon spiritual meaning"},
    "Sep 26": {n: "Hunter's Moon", t: "Release", r: "Focus on a flame. Identify one habit you are hunting down to release. Blow out the candle to seal the end of that cycle.", l: "hunter's moon spiritual meaning"},
    "Oct 25": {n: "Beaver Moon", t: "Preparation", r: "Physically clean your altar or sacred space. Light incense to clear the air. Prepare your inner temple for winter.", l: "beaver moon spiritual meaning"},
    "Nov 24": {n: "Cold Moon", t: "Stillness", r: "Sit in total darkness for 5 minutes. Find the internal light that glows when the external world is frozen.", l: "cold moon spiritual meaning"},
    "Dec 24": {n: "Long Night Moon", t: "Dreaming", r: "Place mugwort or lavender under your pillow. Ask your ancestors to speak to you in the dreamtime tonight.", l: "long night moon spiritual meaning"},
    "Jan 22, 2027": {n: "Threshold Moon", t: "Wisdom", r: "Stand in a doorway. Step through with your right foot, consciously leaving the old cycle behind.", l: "spiritual meaning of 13th moon"}
  };

  const MOON_ANCHORS = [
    {d: new Date(2026, 0, 3), n: "Wolf Moon"}, {d: new Date(2026, 1, 1), n: "Snow Moon"}, {d: new Date(2026, 2, 3), n: "Worm Moon"}, {d: new Date(2026, 3, 2), n: "Pink Moon"}, {d: new Date(2026, 4, 1), n: "Flower Moon"}, {d: new Date(2026, 4, 31), n: "Strawberry Moon"}, {d: new Date(2026, 5, 29), n: "Buck Moon"}, {d: new Date(2026, 6, 29), n: "Sturgeon Moon"}, {d: new Date(2026, 7, 28), n: "Harvest Moon"}, {d: new Date(2026, 8, 26), n: "Hunter's Moon"}, {d: new Date(2026, 9, 25), n: "Beaver Moon"}, {d: new Date(2026, 10, 24), n: "Cold Moon"}, {d: new Date(2026, 11, 24), n: "Long Night Moon"}
  ];

  const FULL_MOONS = [{d: "Jan 3", z: "Cancer ‚ôã"}, {d: "Feb 1", z: "Leo ‚ôå"}, {d: "Mar 3", z: "Virgo ‚ôç"}, {d: "Apr 2", z: "Libra ‚ôé"}, {d: "May 1", z: "Scorpio ‚ôè"}, {d: "May 31", z: "Sagittarius ‚ôê"}, {d: "Jun 29", z: "Capricorn ‚ôë"}, {d: "Jul 29", z: "Aquarius ‚ôí"}, {d: "Aug 28", z: "Pisces ‚ôì"}, {d: "Sep 26", z: "Aries ‚ôà"}, {d: "Oct 25", z: "Taurus ‚ôâ"}, {d: "Nov 24", z: "Gemini ‚ôä"}, {d: "Dec 24", z: "Cancer ‚ôã"}];
  const NEW_MOONS = ["Jan 18", "Feb 17", "Mar 18", "Apr 17", "May 16", "Jun 15", "Jul 14", "Aug 12", "Sep 11", "Oct 10", "Nov 9", "Dec 8"];

  // üõ†Ô∏è HELPER: Dynamic Wisdom Generator (Robust)
  function getDynamicContent(phase, zodiacSign, day) {
    try {
      if(!zodiacSign) return { whisper: "The stars are silent.", ritual: "Breathe." };
      
      const s = zodiacSign.split(' ')[0]; 
      const varIdx = day % 3; 
      
      let pKey = "Waxing";
      if (phase.includes("New")) pKey = "New";
      else if (phase.includes("Full")) pKey = "Full";
      else if (phase.includes("Waning") || phase.includes("Last")) pKey = "Waning";

      let whisper = `The moon in ${s} asks you to listen deeply today.`;
      let ritual = "Sit in silence and breathe.";
      
      if (DAILY_WISDOM_LIBRARY[s] && DAILY_WISDOM_LIBRARY[s][pKey]) {
        whisper = DAILY_WISDOM_LIBRARY[s][pKey][varIdx];
      }
      if (DAILY_RITUALS[s]) {
        ritual = DAILY_RITUALS[s][varIdx];
      }
      
      return { whisper, ritual };
    } catch(err) {
      console.log("Wisdom Error:", err);
      return { whisper: "Listen to your own heart today.", ritual: "Light a candle." };
    }
  }

  function getAffirmation(element) {
    const affirmations = {
      "FIRE": "I am the flame that lights the way.",
      "EARTH": "I am rooted, stable, and strong.",
      "AIR": "My mind is clear; my voice is true.",
      "WATER": "I flow with the sacred tide."
    };
    return affirmations[element] || "I am aligned with the cosmos.";
  }

  function getCelestialData(date) {
    try {
      const dStr = date.toLocaleDateString('en-US', {month:'short', day:'numeric'});
      const jd = (date.getTime() / 86400000) + 2440587.5;
      const T = (jd - 2451545.0) / 36525;
      let moonLong = (218.316 + 481267.881 * T + 6.289 * Math.sin((135.27 + 477198.87 * T) * Math.PI / 180));
      moonLong = (moonLong + 5.0) % 360;
      if (moonLong < 0) moonLong += 360;
      
      const signs = ["Aries ‚ôà","Taurus ‚ôâ","Gemini ‚ôä","Cancer ‚ôã","Leo ‚ôå","Virgo ‚ôç","Libra ‚ôé","Scorpio ‚ôè","Sagittarius ‚ôê","Capricorn ‚ôë","Aquarius ‚ôí","Pisces ‚ôì"];
      const zodIndex = Math.floor(moonLong / 30);
      const zod = signs[zodIndex] || "Aries ‚ôà";
      const el = ZOD_ELEMENTS[zod] || "EARTH";
      
      let sunLong = (280.466 + 36000.770 * T) % 360;
      let angle = (moonLong - sunLong + 360) % 360;
      
      let isFull = FULL_MOONS.some(m => m.d === dStr);
      let isNew = NEW_MOONS.includes(dStr);
      let isPivot = PIVOTS[dStr];
      let isEvent = CELESTIAL_EVENTS[dStr];

      let phase = "Waning Crescent", ico = "üåò";
      if (isFull) { phase = "Full Moon"; ico = "üåï"; }
      else if (isNew) { phase = "New Moon"; ico = "üåë"; }
      else if (angle < 90) { phase = "Waxing Crescent"; ico = "üåí"; }
      else if (angle < 100) { phase = "First Quarter"; ico = "üåì"; }
      else if (angle < 180) { phase = "Waxing Gibbous"; ico = "üåî"; }
      else if (angle < 260) { phase = "Waning Gibbous"; ico = "üåñ"; }
      else if (angle < 280) { phase = "Last Quarter"; ico = "üåó"; }

      let anchor = MOON_ANCHORS[0];
      for (let m of MOON_ANCHORS) { if (date >= m.d) anchor = m; }
      const diffTime = Math.abs(date - anchor.d);
      let tDay = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
      
      // Core Logic
      let archetype = FULL_MOON_DATA[dStr];
      let content = getDynamicContent(phase, zod, date.getDate());
      
      const whisperFallback = "The stars guide you.";
      
      let whisper = archetype ? archetype.t + ": " + whisperFallback : content.whisper;
      let ritual = archetype ? archetype.r : content.ritual;
      let affirm = getAffirmation(el);
      
      let shadow = "";
      if (isNew) {
        shadow = SHADOW_WORK[zod.split(' ')[0]] || "What is hidden?";
      }

      if (dStr === "Jan 22" && date.getFullYear() === 2027) {
         archetype = FULL_MOON_DATA["Jan 22, 2027"];
         isFull = true; whisper = archetype.t + ": Wisdom flows."; ritual = archetype.r;
      }

      return { phase, ico, zod, tDay, el, elColor: ELEMENTS[el], dStr, year: date.getFullYear(), isFull, isNew, isPivot, isEvent, archetype, whisper, ritual, shadow, affirm };
    } catch(e) {
      console.log("Celestial Calc Error", e);
      return { phase: "Moon", ico: "üåë", zod: "Aries ‚ôà", tDay: 1, el: "FIRE", elColor: "#fff", dStr: "", year: 2026, isFull:false, isNew:false, isPivot:false, isEvent:false, archetype:null, whisper:"Quiet.", ritual:"Breathe.", shadow:"", affirm:"" };
    }
  }

  function render() {
    const grid = document.getElementById("calendar"); 
    if(!grid) return;
    grid.innerHTML = "";
    document.getElementById("monthLabel").innerText = `${activeD.toLocaleString('default', { month: 'long' }).toUpperCase()} ${activeD.getFullYear()}`;
    ["M","T","W","T","F","S","S"].forEach(l => grid.innerHTML += `<div class="day-label">${l}</div>`);
    const first = new Date(activeD.getFullYear(), activeD.getMonth(), 1);
    const last = new Date(activeD.getFullYear(), activeD.getMonth() + 1, 0).getDate();
    let offset = (first.getDay() === 0) ? 6 : first.getDay() - 1;
    for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;
    
    const todayStr = new Date().toDateString();

    for(let i=1; i<=last; i++) {
      const d = new Date(activeD.getFullYear(), activeD.getMonth(), i);
      const data = getCelestialData(d);
      const cell = document.createElement("div");
      
      let classes = ['day'];
      if(d.toDateString() === selectedDate) classes.push('selected');
      if(d.toDateString() === todayStr) classes.push('today');
      if(data.isFull) classes.push('full-moon-day');
      if(data.isNew) classes.push('new-moon-day');
      if(data.isPivot || data.isEvent) classes.push('celestial-pivot');
      if(db.logs[d.toDateString()]) classes.push('period');
      
      cell.className = classes.join(' ');
      cell.innerHTML = `<span class="d-num">${i}</span><span class="t-num">${data.tDay}</span><span class="m-ico" style="filter: drop-shadow(0 0 5px ${data.elColor})">${data.ico}</span><span class="z-ico">${data.zod.split(' ')[0]}</span>`;
      cell.onclick = () => { selectedDate = d.toDateString(); updateDash(d); render(); };
      grid.appendChild(cell);
    }
  }

  function updateDash(date) {
    const data = getCelestialData(date);
    document.documentElement.style.setProperty('--aura', data.elColor);
    
    // Redundancy check
    const displayTitle = data.archetype ? data.archetype.n.toUpperCase() : `${data.phase.toUpperCase()} ${data.ico}`;
    document.getElementById("dashTitle").innerText = displayTitle;
    
    if (displayTitle.includes(data.phase.toUpperCase())) {
       document.getElementById("detailedPhase").innerText = "";
    } else {
       document.getElementById("detailedPhase").innerText = data.phase.toUpperCase();
    }
    
    document.getElementById("dashSub").innerText = `LUNAR DAY ${data.tDay} ‚Ä¢ ${data.dStr}, ${data.year}`;
    document.getElementById("elementTag").innerText = `‚úß ${data.el} ENERGY ‚úß`;
    document.getElementById("journalInput").value = db.journals[date.toDateString()] || "";
    document.getElementById("flowBtn").className = db.logs[date.toDateString()] ? "cycle-btn active" : "cycle-btn";
    
    let eventHTML = "";
    if(data.isPivot && data.isPivot.n === "Spring Equinox") {
      eventHTML += `<div class="event-badge newyear-badge" onclick="openModal('${data.isPivot.n}', '${data.isPivot.d}', '${data.isPivot.l}')">HAPPY ANCESTRAL NEW YEAR! üå∏‚ú®üåø</div><br>`;
    } else if(data.isPivot) {
      eventHTML += `<div class="event-badge portal-badge" onclick="openModal('${data.isPivot.n}', '${data.isPivot.d}', '${data.isPivot.l}')">‚ú® ${data.isPivot.n.toUpperCase()}</div>`;
    }
    
    if(data.isEvent) eventHTML += `<div class="event-badge retro-badge" onclick="openModal('${data.isEvent.n}', '${data.isEvent.d}', '${data.isEvent.l}')">üëÅÔ∏è ${data.isEvent.n.toUpperCase()}</div>`;
    
    eventHTML += `<div class="event-badge zodiac-badge" onclick="openZodiacModal('${data.zod.split(' ')[0]}')">‚ú® MOON IN ${data.zod.toUpperCase()}</div>`;
    eventHTML += `<div class="event-badge phase-badge" onclick="openPhaseModal('${data.phase}')">üîÆ PHASE INTEL</div>`;
    
    if(data.archetype && data.isFull) eventHTML += `<div class="event-badge moon-badge" onclick="openModal('${data.archetype.n}', 'Full Moon in ${data.zod}. Theme: ${data.archetype.t}.', '${data.archetype.l}')">üëÅÔ∏è INTEL</div>`;
    
    document.getElementById("eventDisplay").innerHTML = eventHTML;
    document.getElementById("guidanceText").innerText = data.whisper;
    document.getElementById("ritualText").innerText = data.ritual;
    document.getElementById("affirmationText").innerText = data.affirm;
    
    if (data.isNew && data.shadow) {
      document.getElementById("shadowCard").style.display = "block";
      document.getElementById("shadowText").innerText = data.shadow;
    } else {
      document.getElementById("shadowCard").style.display = "none";
    }
    
    const savedEnergy = db.energy[date.toDateString()];
    document.querySelectorAll('.energy-btn').forEach(btn => btn.classList.remove('active'));
    if(savedEnergy) {
      const map = {'fire':'e-fire','water':'e-water','air':'e-air','earth':'e-earth'};
      if(document.getElementById(map[savedEnergy])) document.getElementById(map[savedEnergy]).classList.add('active');
      const labels = {'fire':'FIRE: HIGH / CREATIVE','water':'WATER: EMOTIONAL / FLOW','air':'AIR: MENTAL / CLEAR','earth':'EARTH: REST / GROUNDED'};
      document.getElementById("energyLabel").innerText = labels[savedEnergy];
    } else {
      document.getElementById("energyLabel").innerText = "Select your dominant energy";
    }
    
    db.zodCache[date.toDateString()] = data.zod;
    localStorage.setItem('ancestral_moon_v71', JSON.stringify(db));
  }

  function setEnergy(val) {
    let map = {'üî•':'fire','üíß':'water','üå¨Ô∏è':'air','ü™®':'earth'};
    db.energy[selectedDate] = map[val];
    localStorage.setItem('ancestral_moon_v71', JSON.stringify(db));
    updateDash(new Date(selectedDate));
  }

  function openModal(title, desc, query) {
    document.getElementById("modalTitle").innerText = title;
    document.getElementById("modalText").innerText = desc;
    document.getElementById("sunMoonDistinction").style.display = "none";
    document.getElementById("modalLink").href = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
    document.getElementById("cosmicModal").style.display = "block";
    document.querySelector(".modal-overlay").style.display = "block";
  }

  function openZodiacModal(sign) {
    document.getElementById("modalTitle").innerText = `MOON IN ${sign.toUpperCase()}`;
    document.getElementById("modalText").innerText = ZODIAC_WISDOM[sign];
    document.getElementById("sunMoonDistinction").style.display = "block";
    document.getElementById("modalLink").href = `https://www.google.com/search?q=moon+in+${sign}+spiritual+meaning`;
    document.getElementById("cosmicModal").style.display = "block";
    document.querySelector(".modal-overlay").style.display = "block";
  }

  function openPhaseModal(phaseName) {
    document.getElementById("modalTitle").innerText = phaseName.toUpperCase();
    document.getElementById("modalText").innerText = PHASE_MEANINGS[phaseName] || "Trust the cycle.";
    document.getElementById("sunMoonDistinction").style.display = "none";
    document.getElementById("modalLink").href = `https://www.google.com/search?q=${phaseName}+moon+spiritual+meaning`;
    document.getElementById("cosmicModal").style.display = "block";
    document.querySelector(".modal-overlay").style.display = "block";
  }

  function closeModal() { document.getElementById("cosmicModal").style.display = "none"; document.querySelector(".modal-overlay").style.display = "none"; }

  function copySisterReport() {
    const d = new Date(selectedDate);
    const data = getCelestialData(d);
    let extra = data.isEvent ? `\nüåÄ Intel: ${data.isEvent.n}` : "";
    if (data.isPivot) extra = `\n‚ú® Portal: ${data.isPivot.n}`;
    let shadow = data.isNew ? `\nüåë Shadow Work: ${data.shadow}` : "";

    const report = `‚òæ Ancestral Moon Report: ${data.dStr}, ${data.year} ‚òΩ\nMoon: ${data.archetype ? data.archetype.n : data.phase}\nSign: ${data.zod} (${data.el})\n\nWhisper: ${document.getElementById("guidanceText").innerText}\n\nRitual: ${data.ritual}${shadow}${extra}\n\nSynced via The Ancestral Moon Map ‚ú®`;
    navigator.clipboard.writeText(report).then(() => alert("Report Copied!"));
  }

  function jumpToDate(dateStr) { selectedDate = dateStr; activeD = new Date(dateStr); render(); updateDash(activeD); showView('dash'); }
  function deleteEntry(dateStr) { if(confirm("Release this entry?")) { delete db.journals[dateStr]; delete db.logs[dateStr]; delete db.energy[dateStr]; localStorage.setItem('ancestral_moon_v71', JSON.stringify(db)); showView('grimoire'); } }

  function backupData() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "ancestral_moon_backup.json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
  }

  function restoreData(input) {
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const importedDb = JSON.parse(e.target.result);
        db = importedDb;
        localStorage.setItem('ancestral_moon_v71', JSON.stringify(db));
        alert("Grimoire Restored Successfully.");
        render(); updateDash(new Date(selectedDate)); showView('grimoire');
      } catch(err) { alert("Invalid backup file."); }
    };
    reader.readAsText(file);
  }

  function exportToCSV() {
    let csv = "Date,Moon Phase,Zodiac,Element,Flow,Energy,Journal Entry\n";
    const dates = Object.keys(db.journals).concat(Object.keys(db.logs), Object.keys(db.energy)).sort((a,b) => new Date(b) - new Date(a));
    const uniqueDates = [...new Set(dates)];
    
    uniqueDates.forEach(dStr => {
      const d = new Date(dStr);
      const celestial = getCelestialData(d);
      
      let flow = db.logs[dStr] ? "Yes" : "No";
      let energy = db.energy[dStr] ? db.energy[dStr].toUpperCase() : "N/A";
      let entry = db.journals[dStr] ? db.journals[dStr].replace(/(\r\n|\n|\r)/gm, " ").replace(/"/g, '""') : "";
      let phase = celestial.archetype ? celestial.archetype.n : celestial.phase;
      
      csv += `"${dStr}","${phase}","${celestial.zod}","${celestial.el}","${flow}","${energy}","${entry}"\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    link.setAttribute("href", url);
    link.setAttribute("download", "grimoire_export.csv");
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function showView(view) {
    document.getElementById('oracleDash').style.display = 'none';
    document.getElementById('grimoireView').style.display = 'none';
    document.getElementById('yearlyView').style.display = 'none';
    if(view === 'dash') document.getElementById('oracleDash').style.display = 'block';
    
    if(view === 'grimoire') {
      const g = document.getElementById('grimoireView'); g.style.display = 'block';
      const cont = document.getElementById('grimoireContent'); cont.innerHTML = "";
      const dates = Object.keys(db.journals).concat(Object.keys(db.logs), Object.keys(db.energy)).sort((a,b) => new Date(b) - new Date(a));
      [...new Set(dates)].forEach(d => {
        if(db.journals[d] || db.logs[d] || db.energy[d]) {
          let en = db.energy[d] ? (db.energy[d] === 'fire' ? 'üî•' : db.energy[d] === 'water' ? 'üíß' : db.energy[d] === 'air' ? 'üå¨Ô∏è' : 'ü™®') : '';
          cont.innerHTML += `<div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:15px; margin-bottom:10px; text-align:left; border-left:3px solid var(--aura);">
            <div style="font-size:0.6rem; color:var(--gold); display:flex; justify-content:space-between; margin-bottom:5px;"><span>${d} ‚Ä¢ ${db.zodCache[d] || 'Cosmos'}</span> <span>${en} ${db.logs[d] ? 'ü©∏' : ''}</span></div>
            <div style="font-family:'Charm'; font-size:1.1rem; color:#eee;">${db.journals[d] || "<i>Quiet.</i>"}</div>
            <div class="grim-actions"><button class="grim-btn" onclick="jumpToDate('${d}')">‚úèÔ∏è</button><button class="grim-btn" onclick="deleteEntry('${d}')">üóëÔ∏è</button></div>
          </div>`;
        }
      });
    }
    if(view === 'yearly') {
      document.getElementById('yearlyView').style.display = 'block';
      const yc = document.getElementById('yearlyContent'); yc.innerHTML = "";
      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel';">CELESTIAL PIVOTS</h4>`;
      for(let p in PIVOTS) yc.innerHTML += `<div style="display:flex; justify-content:space-between; font-size:0.7rem; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0;"><span>‚ú® ${PIVOTS[p].n}</span> <span>${p}</span></div>`;
      for(let e in CELESTIAL_EVENTS) yc.innerHTML += `<div style="display:flex; justify-content:space-between; font-size:0.7rem; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0; color:var(--retro);"><span>üåÄ ${CELESTIAL_EVENTS[e].n}</span> <span>${e}</span></div>`;
      
      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel'; margin-top:20px;">13 FULL MOONS</h4>`;
      FULL_MOONS.forEach(m => {
        const arch = FULL_MOON_DATA[m.d] || {n:"Moon"};
        yc.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0;"><span>üåï ${m.d} - ${arch.n}</span> <span>${m.z}</span></div>`;
      });

      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel'; margin-top:20px;">13 NEW MOONS</h4>`;
      NEW_MOONS.forEach(dStr => {
        const d = new Date(`${dStr}, 2026`);
        const data = getCelestialData(d);
        yc.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0; color:var(--amethyst);"><span>üåë ${dStr} - New Moon</span> <span>${data.zod}</span></div>`;
      });
    }
  }

  function saveData() { db.journals[selectedDate] = document.getElementById("journalInput").value; localStorage.setItem('ancestral_moon_v71', JSON.stringify(db)); }
  function toggleFlow() { db.logs[selectedDate] = !db.logs[selectedDate]; localStorage.setItem('ancestral_moon_v71', JSON.stringify(db)); render(); updateDash(new Date(selectedDate)); }
  function changeMonth(n) { activeD.setMonth(activeD.getMonth() + n); render(); }

  const sField = document.getElementById('starField');
  for(let i=0; i<80; i++) {
    const s = document.createElement('div'); s.className = 'star';
    s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%';
    s.style.width = Math.random()*2+'px'; s.style.setProperty('--d', (Math.random()*4+2)+'s'); sField.appendChild(s);
  }

  render(); updateDash(new Date());
</script>
</body>
</html>

