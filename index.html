<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>13 Moon Calendar</title>
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: #0b0d17; color: #eee; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
    .day { background: #15192d; border-radius: 10px; padding: 10px; cursor: pointer; min-height: 90px; transition: background 0.2s; position: relative; }
    .day:hover { background: #1f2550; }
    .gregorian { font-size: 0.8rem; opacity: 0.7; }
    .moon-day { font-size: 1.1rem; font-weight: bold; margin-top: 5px; }
    .moon-name { font-size: 0.75rem; opacity: 0.8; margin-top: 4px; }
    .label-weekday { text-align:center; font-size:0.85rem; opacity:0.75; margin-bottom:8px; }
    #dayInfo { margin-top: 30px; padding: 20px; border-radius: 12px; background: #15192d; }
    .day.today { border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 0 12px rgba(180,200,255,0.6); background: radial-gradient(circle at top, rgba(255,255,255,0.08), #15192d); }
    .solstice { outline: 2px solid rgba(255,200,100,0.18); box-shadow: 0 0 8px rgba(255,200,100,0.06) inset; }
    .equinox { outline: 2px solid rgba(100,200,255,0.18); box-shadow: 0 0 8px rgba(100,200,255,0.06) inset; }
    .lunar-new-year { outline: 2px solid rgba(255,120,200,0.18); box-shadow: 0 0 8px rgba(255,120,200,0.06) inset; }
    .special-badge { position: absolute; top: 6px; right: 8px; font-size: 0.7rem; padding: 2px 6px; border-radius: 8px; opacity: 0.95; }
    .solstice .special-badge { background: rgba(255,200,100,0.12); color: #ffdca0; }
    .equinox .special-badge { background: rgba(100,200,255,0.10); color: #bfe8ff; }
    .lunar-new-year .special-badge { background: rgba(255,120,200,0.10); color:#ffd0f0; }
    .legend { display:flex; gap:10px; justify-content:center; margin-bottom:12px; font-size:0.9rem; opacity:0.85; }
  </style>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <h1>13 Moon Calendar</h1>

  <div id="lunarGuidance">
    <h2>üåô Today‚Äôs Lunar Guidance</h2>
    <p id="lunarPhase"></p>
    <p><strong>Affirmation:</strong> <span id="affirmation"></span></p>
    <p><strong>Suggested Ritual:</strong> <span id="ritual"></span></p>
  </div>

  <div class="legend">
    <div><span style="background:rgba(255,200,100,0.12); padding:4px 8px; border-radius:6px; color:#ffdca0;">‚òÄ Solstice</span></div>
    <div><span style="background:rgba(100,200,255,0.10); padding:4px 8px; border-radius:6px; color:#bfe8ff;">‚öñ True Rebirth (Spring Equinox)</span></div>
    <div><span style="background:rgba(255,120,200,0.10); padding:4px 8px; border-radius:6px; color:#ffd0f0;">üèÆ Lunar New Year</span></div>
  </div>

  <div id="calendar"></div>

  <div id="dayInfo">
    <h2>Selected Day</h2>
    <p id="dayText">Click a day to see its energy.</p>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const calendar = document.getElementById("calendar");
  const dayText = document.getElementById("dayText");

  if (!calendar) {
    console.error("Calendar element missing");
    return;
  }

  // =========================
  // üåë LUNAR YEAR ANCHOR
  // =========================
  // New Moon on Jan 11, 2024 (verified astronomical new moon)
  const LUNAR_YEAR_ANCHOR = new Date(2024, 0, 11);

  const MS_PER_DAY = 86400000;
  const LUNAR_MONTH_LENGTH = 28;

  // =========================
  // üåô MOON ARCHETYPES (13)
  // =========================
  const MOON_ARCHETYPES = [
    "Initiation",
    "Stability",
    "Growth",
    "Harmony",
    "Blooming",
    "Nurturing",
    "Illumination",
    "Transformation",
    "Harvest",
    "Mysticism",
    "Vision",
    "Purification",
    "Restoration"
  ];

  // =========================
  // üåï SEASONAL MOON NAMES
  // =========================
  const SEASONAL_MOONS = [
    "Wolf Moon",
    "Snow Moon",
    "Worm Moon",
    "Pink Moon",
    "Flower Moon",
    "Strawberry Moon",
    "Buck Moon",
    "Sturgeon Moon",
    "Harvest Moon",
    "Hunter‚Äôs Moon",
    "Beaver Moon",
    "Cold Moon"
  ];

  // =========================
  // üîÆ ZODIAC
  // =========================
  function getZodiac(date) {
    const d = date.getDate(), m = date.getMonth() + 1;
    if ((m==3&&d>=21)||(m==4&&d<=19)) return "Aries";
    if ((m==4&&d>=20)||(m==5&&d<=20)) return "Taurus";
    if ((m==5&&d>=21)||(m==6&&d<=20)) return "Gemini";
    if ((m==6&&d>=21)||(m==7&&d<=22)) return "Cancer";
    if ((m==7&&d>=23)||(m==8&&d<=22)) return "Leo";
    if ((m==8&&d>=23)||(m==9&&d<=22)) return "Virgo";
    if ((m==9&&d>=23)||(m==10&&d<=22)) return "Libra";
    if ((m==10&&d>=23)||(m==11&&d<=21)) return "Scorpio";
    if ((m==11&&d>=22)||(m==12&&d<=21)) return "Sagittarius";
    if ((m==12&&d>=22)||(m==1&&d<=19)) return "Capricorn";
    if ((m==1&&d>=20)||(m==2&&d<=18)) return "Aquarius";
    return "Pisces";
  }

  // =========================
  // üåë MOON PHASE
  // =========================
  function getMoonPhase(date) {
    if (!window.SunCalc) return "üåô";

    const p = SunCalc.getMoonIllumination(date).phase;
    if (p < 0.03 || p > 0.97) return "üåë New Moon";
    if (p < 0.22) return "üåí Waxing Crescent";
    if (p < 0.28) return "üåì First Quarter";
    if (p < 0.47) return "üåî Waxing Gibbous";
    if (p < 0.53) return "üåï Full Moon";
    if (p < 0.72) return "üåñ Waning Gibbous";
    if (p < 0.78) return "üåó Last Quarter";
    return "üåò Waning Crescent";
  }

  // =========================
  // üåô LUNISOLAR CALC
  // =========================
  function getLunarData(date) {
    const daysSinceAnchor =
      Math.floor((date - LUNAR_YEAR_ANCHOR) / MS_PER_DAY);

    const moonDay =
      ((daysSinceAnchor % LUNAR_MONTH_LENGTH) + LUNAR_MONTH_LENGTH) %
        LUNAR_MONTH_LENGTH + 1;

    const moonIndex =
      Math.floor(daysSinceAnchor / LUNAR_MONTH_LENGTH) % 13;

    return {
      moonDay,
      moonIndex,
      archetype: MOON_ARCHETYPES[moonIndex]
    };
  }

  // =========================
  // üóìÔ∏è RENDER MONTH
  // =========================
  function renderMonth(year, month) {
    calendar.innerHTML = "";

    const firstDay = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay.getDay(); i++) {
      calendar.appendChild(document.createElement("div"));
    }

    const today = new Date();

    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month, day);
      const lunar = getLunarData(date);
      const zodiac = getZodiac(date);
      const phase = getMoonPhase(date);

      const cell = document.createElement("div");
      cell.className = "day";

      if (
        date.toDateString() === today.toDateString()
      ) {
        cell.classList.add("today");
      }

      cell.innerHTML = `
        <div class="gregorian">${date.toDateString()}</div>
        <div class="moon-day">${phase}</div>
        <div class="moon-name">
          ${lunar.archetype} ¬∑ Day ${lunar.moonDay} ¬∑ ${zodiac}
        </div>
      `;

      cell.onclick = () => {
        dayText.innerText = `
${date.toDateString()}

${phase}
Moon Archetype: ${lunar.archetype}
Moon Day: ${lunar.moonDay}
Zodiac: ${zodiac}

Guidance:
Move with awareness. Align action with intuition.
        `;
      };

      calendar.appendChild(cell);
    }
  }

  // =========================
  // üöÄ START
  // =========================
  const now = new Date();
  renderMonth(now.getFullYear(), now.getMonth());

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
});
</script>

</body>
</html>
