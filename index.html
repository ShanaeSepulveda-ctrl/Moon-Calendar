<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>The Ancestral Moon Map | V48 Universal Rituals</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Charm:wght@400;700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
  <style>
    :root { 
      --space: #020105; --gold: #e6ccff; --glass: rgba(10, 5, 20, 0.94); 
      --blood: #ff3385; --aura: #9d50bb; --amethyst: #df80ff;
      --full: rgba(230, 204, 255, 0.4); --new: rgba(75, 0, 130, 0.5);
    }
    body { 
      font-family: 'Quicksand', sans-serif; background: var(--space); 
      background-image: radial-gradient(circle at top, #160a25 0%, var(--space) 100%); 
      color: #fdfbff; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden;
    }
    .star-field { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) infinite ease-in-out; }
    @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }

    #oracleDash, #grimoireView, #yearlyView { 
      width: 92%; max-width: 450px; background: var(--glass); backdrop-filter: blur(30px); 
      border: 1px solid rgba(230, 204, 255, 0.1); border-top: 3px solid var(--aura); 
      border-radius: 35px; padding: 20px; margin: 15px 0; box-shadow: 0 15px 50px rgba(0,0,0,0.9); text-align: center; display: none; 
    }
    #oracleDash { display: block; }

    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 450px; margin-bottom: 10px; }
    .day-label { font-size: 0.55rem; color: var(--gold); font-family: 'Cinzel'; opacity: 0.6; }
    .day { background: rgba(255,255,255,0.02); border-radius: 10px; aspect-ratio: 1/1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 1.5px solid transparent; cursor: pointer; transition: 0.3s; }
    .day.today { border: 2.5px solid var(--gold); box-shadow: 0 0 15px var(--gold); z-index: 2; }
    .day.full-moon-day { background: radial-gradient(circle, var(--full) 0%, transparent 70%); }
    .day.new-moon-day { background: radial-gradient(circle, var(--new) 0%, transparent 70%); }
    .day.celestial-pivot { border: 1.5px dashed var(--gold); background: rgba(230, 204, 255, 0.05); }
    .day.selected { border: 1px solid #fff; background: rgba(255, 255, 255, 0.1); }
    .day.period { border-bottom: 3px solid var(--blood) !important; }

    .d-num { position: absolute; top: 4px; left: 6px; font-size: 0.55rem; opacity: 0.4; }
    .t-num { position: absolute; top: 4px; right: 6px; font-size: 0.55rem; color: var(--gold); font-weight: bold; }
    .m-ico { font-size: 1rem; margin-top: 5px; filter: drop-shadow(0 0 5px var(--aura)); }
    .z-ico { font-size: 0.45rem; color: var(--gold); margin-top: 2px; font-family: 'Cinzel'; }

    .nav-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--gold); border-radius: 15px; padding: 8px 12px; font-family: 'Cinzel'; font-size: 0.6rem; margin: 5px; }
    .cycle-btn { border: 1.5px solid var(--blood); color: var(--blood); background: transparent; padding: 14px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.8rem; width: 100%; margin-top: 15px; }
    .cycle-btn.active { background: var(--blood); color: white; box-shadow: 0 0 15px var(--blood); }
    .sister-btn { background: var(--aura); color: white; border: none; padding: 14px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.75rem; width: 100%; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

    .wisdom-card { text-align: left; background: rgba(0,0,0,0.4); padding: 20px; border-radius: 25px; border-left: 3px solid var(--aura); margin-bottom: 15px; }
    .wisdom-label { font-family: 'Cinzel'; font-size: 0.6rem; color: var(--gold); letter-spacing: 2px; display: block; margin-bottom: 8px; }
    .wisdom-text { font-family: 'Charm'; font-size: 1.2rem; line-height: 1.4; color: #eee; }
    #journalInput { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; color: #fff; font-family: 'Charm'; font-size: 1.2rem; min-height: 100px; box-sizing: border-box; outline: none; }
  </style>
</head>
<body>
<div class="star-field" id="starField"></div>
<div style="display: flex; justify-content: space-between; width: 92%; max-width: 450px;">
  <button class="nav-btn" onclick="showView('yearly')">YEARLY MAP</button>
  <button class="nav-btn" onclick="showView('grimoire')">GRIMOIRE</button>
</div>
<div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 450px; margin: 10px 0;">
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(-1)">â˜¾</span>
  <h3 id="monthLabel" style="font-family:'Cinzel'; letter-spacing: 4px; margin:0; font-size: 1.1rem;"></h3>
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(1)">â˜½</span>
</div>
<div id="calendar"></div>
<div id="oracleDash">
  <div id="eventDisplay"></div>
  <div id="elementTag" style="font-size: 0.5rem; letter-spacing: 1.5px; color: var(--aura); font-weight: bold; margin-bottom: 5px;"></div>
  <h2 id="dashTitle" style="font-family:'Cinzel'; margin: 5px 0; color:var(--gold); letter-spacing: 3px; font-size: 1.3rem;"></h2>
  <div id="dashSub" style="font-size: 0.6rem; letter-spacing: 2px; margin-bottom: 15px; opacity: 0.8; font-family: 'Cinzel';"></div>
  <div class="wisdom-card">
    <span class="wisdom-label">ANCESTRAL WHISPER</span>
    <div class="wisdom-text" id="guidanceText"></div>
  </div>
  <div class="wisdom-card">
    <span class="wisdom-label">SACRED RITUAL</span>
    <div class="wisdom-text" id="ritualText"></div>
  </div>
  <textarea id="journalInput" placeholder="Scribe your journey..." oninput="saveData()"></textarea>
  <button id="flowBtn" class="cycle-btn" onclick="toggleFlow()">MARK MOON FLOW</button>
  <button class="sister-btn" onclick="copySisterReport()">âœ¨ SISTER CONNECTION REPORT âœ¨</button>
</div>

<script>
  let activeD = new Date(2026, 0, 16); 
  let selectedDate = new Date().toDateString();
  let db = JSON.parse(localStorage.getItem('ancestral_moon_map')) || { logs: {}, journals: {}, zodCache: {} };

  const ELEMENTS = { "FIRE": "#ff4d4d", "EARTH": "#2ecc71", "AIR": "#3498db", "WATER": "#df80ff" };
  const ZOD_ELEMENTS = { "Aries â™ˆ":"FIRE", "Leo â™Œ":"FIRE", "Sagittarius â™":"FIRE", "Taurus â™‰":"EARTH", "Virgo â™":"EARTH", "Capricorn â™‘":"EARTH", "Gemini â™Š":"AIR", "Libra â™Ž":"AIR", "Aquarius â™’":"AIR", "Cancer â™‹":"WATER", "Scorpio â™":"WATER", "Pisces â™“":"WATER" };
  
  const MOON_DEEP = {
    "Wolf Moon": {r: "Light a single white candle. Scribe your deepest truth onto a leaf and release it to the wind.", w: "The pack provides protection, but the soul must lead. Listen to the inner pulse that knows the way through the cold."},
    "Snow Moon": {r: "Write down a burden on paper and place it under a bowl of salt or earth, symbolizing its burial and renewal.", w: "In the stillness of the frost, all is quiet. Use this silence to hear the heartbeat of the ancestors beneath the ground."},
    "Worm Moon": {r: "Press your hands against the earth or a stone. Feel the slow awakening of the life force returning to the world.", w: "The soil is softening and the first stirrings of change are near. Your potential is ready to breach the surface."},
    "Pink Moon": {r: "Anoint your pulse points with water or oil. Visualize your intentions blossoming like wild flowers in a field.", w: "Purity is not the absence of life, but the clarity of it. Bloom with the same relentless grace as the spring."},
    "Flower Moon": {r: "Gather natural elements to create a small offering of beauty. Leave it where the moon's light will touch it.", w: "Life is a generous host. Abundance flows toward those who recognize the inherent beauty in all stages of growth."},
    "Strawberry Moon": {r: "Savor a single seed or fruit mindfully, giving thanks for the nourishment that sustains your physical vessel.", w: "The sweetness of the journey is found in the presence. Recognize the ripening of the seeds you planted cycles ago."},
    "Buck Moon": {r: "Stand with feet rooted and arms reaching high. Imagine your spirit expanding to touch the boundaries of the cosmos.", w: "Strength is born from endurance. Assert your sovereignty and protect the sacred space you have cultivated."},
    "Sturgeon Moon": {r: "Submerge your hands in cool water. Ask the ancient waters to wash away what no longer serves your resilience.", w: "Wisdom resides in the depths. Trust the unseen currents of your intuition to guide you through the darkest waters."},
    "Harvest Moon": {r: "Place three stones in a bowl. For each stone, name a lesson you have harvested during this turn of the sun.", w: "Gratitude is the bridge between effort and reward. Honor the cycle of labor and the rest that follows the reap."},
    "Hunter's Moon": {r: "Build a small fire or gaze into a flame. Focus your intent on a single goal you wish to achieve before winter.", w: "Vision requires a steady heart. Aim your energy with precision at that which truly feeds your soul's purpose."},
    "Beaver Moon": {r: "Tidy a corner of your living space. Organize one physical thing to reflect the organization of your inner sanctuary.", w: "Preparation is an act of self-love. Tend to the foundation of your life before the cycle turns inward for the deep rest."},
    "Cold Moon": {r: "Sit in total darkness for three minutes. Acknowledge the light that exists only in your mind's eye.", w: "The dark is the womb of all creation. Trust the gestation of your dreams while the world sleeps under the frost."},
    "Long Night Moon": {r: "Scribe a dream on a piece of paper and tuck it beneath your pillow. Invite ancestral guidance into your sleep.", w: "The longest night is the turning point. In the deepest shadow, the promise of the returning sun is already felt."},
    "Threshold Moon": {r: "Stand at a threshold. Step forward with intention, leaving behind one habit that belongs to the past.", w: "You are the bridge between the old and the new. Walk with the wisdom of all the moons that have come before."}
  };

  const FULL_MOONS = [
    {d: "Jan 3", z: "Cancer", n: "Wolf Moon"}, {d: "Feb 1", z: "Leo", n: "Snow Moon"}, 
    {d: "Mar 3", z: "Virgo", n: "Worm Moon"}, {d: "Apr 2", z: "Libra", n: "Pink Moon"}, 
    {d: "May 1", z: "Scorpio", n: "Flower Moon"}, {d: "May 31", z: "Sagittarius", n: "Strawberry Moon"}, 
    {d: "Jun 29", z: "Capricorn", n: "Buck Moon"}, {d: "Jul 29", z: "Aquarius", n: "Sturgeon Moon"}, 
    {d: "Aug 28", z: "Pisces", n: "Harvest Moon"}, {d: "Sep 26", z: "Aries", n: "Hunter's Moon"}, 
    {d: "Oct 25", z: "Taurus", n: "Beaver Moon"}, {d: "Nov 24", z: "Gemini", n: "Cold Moon"}, 
    {d: "Dec 24", z: "Cancer", n: "Long Night Moon"}
  ];
  const NEW_MOONS = ["Jan 18", "Feb 17", "Mar 18", "Apr 17", "May 16", "Jun 15", "Jul 14", "Aug 12", "Sep 11", "Oct 10", "Nov 9", "Dec 8"];
  const PIVOTS = {"Mar 20": "Spring Equinox", "Jun 21": "Summer Solstice", "Sep 22": "Autumn Equinox", "Dec 21": "Winter Solstice"};

  function getCelestialData(date) {
    const dStr = date.toLocaleDateString('en-US', {month:'short', day:'numeric'});
    const jd = (date.getTime() / 86400000) + 2440587.5;
    const T = (jd - 2451545.0) / 36525;
    let moonLong = (218.316 + 481267.881 * T + 6.289 * Math.sin((135.27 + 477198.87 * T) * Math.PI / 180));
    moonLong = (moonLong + 5.0) % 360; 
    const zod = ["Aries â™ˆ","Taurus â™‰","Gemini â™Š","Cancer â™‹","Leo â™Œ","Virgo â™","Libra â™Ž","Scorpio â™","Sagittarius â™","Capricorn â™‘","Aquarius â™’","Pisces â™“"][Math.floor(moonLong / 30)];
    let angle = (moonLong - ((280.466 + 36000.770 * T) % 360) + 360) % 360;
    
    let fm = FULL_MOONS.find(m => m.d === dStr);
    let moonName = fm ? fm.n : (angle > 185 ? "Waning Moon" : "Waxing Moon");
    if (dStr === "Jan 22, 2027") moonName = "Threshold Moon";

    const equinox = new Date(2026, 2, 20).getTime();
    const diff = Math.floor((date.getTime() - equinox) / 86400000);
    let tDay = (diff % 28) + 1; if (tDay <= 0) tDay += 28;
    
    return { ico: fm?"ðŸŒ•": (NEW_MOONS.includes(dStr)?"ðŸŒ‘":"â˜¾"), zod, tDay, el: ZOD_ELEMENTS[zod], elColor: ELEMENTS[ZOD_ELEMENTS[zod]], dStr, isFull: !!fm, moonName };
  }

  function render() {
    const grid = document.getElementById("calendar"); grid.innerHTML = "";
    document.getElementById("monthLabel").innerText = activeD.toLocaleString('default', { month: 'long' }).toUpperCase();
    ["M","T","W","T","F","S","S"].forEach(l => grid.innerHTML += `<div class="day-label">${l}</div>`);
    const first = new Date(activeD.getFullYear(), activeD.getMonth(), 1);
    const last = new Date(activeD.getFullYear(), activeD.getMonth() + 1, 0).getDate();
    let offset = (first.getDay() === 0) ? 6 : first.getDay() - 1;
    for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;
    for(let i=1; i<=last; i++) {
      const d = new Date(activeD.getFullYear(), activeD.getMonth(), i);
      const data = getCelestialData(d);
      const cell = document.createElement("div");
      cell.className = `day ${d.toDateString() === selectedDate?'selected':''} ${d.toDateString() === new Date().toDateString()?'today':''} ${data.isFull?'full-moon-day':''} ${db.logs[d.toDateString()]?'period':''}`;
      cell.innerHTML = `<span class="d-num">${i}</span><span class="t-num">${data.tDay}</span><span class="m-ico" style="filter: drop-shadow(0 0 5px ${data.elColor})">${data.ico}</span><span class="z-ico">${data.zod.split(' ')[0]}</span>`;
      cell.onclick = () => { selectedDate = d.toDateString(); updateDash(d); render(); };
      grid.appendChild(cell);
    }
  }

  function updateDash(date) {
    const data = getCelestialData(date);
    document.documentElement.style.setProperty('--aura', data.elColor);
    document.getElementById("dashTitle").innerText = data.moonName.toUpperCase();
    document.getElementById("dashSub").innerText = `DAY ${data.tDay} â€¢ ${data.zod} â€¢ ${data.dStr}`;
    document.getElementById("elementTag").innerText = `âœ§ ${data.el} ENERGY âœ§`;
    
    const meta = MOON_DEEP[data.moonName] || {r: "Scribe your intentions in your journal and sit in meditation for 5 minutes.", w: "The ancestors observed these same skies to find their way. You are never lost; you are simply in a different phase of the cycle."};
    document.getElementById("guidanceText").innerText = meta.w;
    document.getElementById("ritualText").innerText = meta.r;
    document.getElementById("journalInput").value = db.journals[date.toDateString()] || "";
  }

  function copySisterReport() {
    const d = new Date(selectedDate);
    const data = getCelestialData(d);
    const meta = MOON_DEEP[data.moonName] || {r: "Meditate.", w: "Stay grounded."};
    const report = `â˜¾ Ancestral Moon Report: ${data.dStr} â˜½\nMoon: ${data.moonName}\nSign: ${data.zod}\nElement: ${data.el}\n\nWhisper: ${meta.w}\n\nShared Ritual: ${meta.r}\n\nSynced via The Ancestral Moon Map âœ¨`;
    navigator.clipboard.writeText(report).then(() => {
        const btn = document.querySelector(".sister-btn");
        btn.innerText = "âœ… REPORT COPIED!";
        setTimeout(() => btn.innerText = "âœ¨ SISTER CONNECTION REPORT âœ¨", 2000);
    });
  }

  function toggleFlow() { db.logs[selectedDate] = !db.logs[selectedDate]; localStorage.setItem('ancestral_moon_map', JSON.stringify(db)); render(); }
  function changeMonth(n) { activeD.setMonth(activeD.getMonth() + n); render(); }
  function showView(v) { 
    document.getElementById('oracleDash').style.display='none'; 
    document.getElementById('yearlyView').style.display='none'; 
    document.getElementById(v==='dash'?'oracleDash':v+'View').style.display='block'; 
  }

  const sField = document.getElementById('starField');
  for(let i=0; i<80; i++) {
    const s = document.createElement('div'); s.className = 'star';
    s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%';
    s.style.width = Math.random()*2+'px'; s.style.setProperty('--d', (Math.random()*4+2)+'s'); sField.appendChild(s);
  }
  render(); updateDash(new Date());
</script>
</body>
</html>

