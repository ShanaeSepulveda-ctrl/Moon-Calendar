<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>13 Moon Calendar</title>

  <!-- SunCalc for real lunar astronomy -->
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0b0d17;
      color: #eee;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 12px;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 12px;
    }

    .day {
      background: #15192d;
      border-radius: 10px;
      padding: 8px;
      min-height: 90px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .day:hover {
      background: #1f2550;
    }

    .day.today {
      border: 1px solid rgba(180,200,255,0.6);
      box-shadow: 0 0 12px rgba(180,200,255,0.6);
    }

    .gregorian {
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .moon-name {
      font-size: 0.75rem;
      opacity: 0.85;
      margin-top: 4px;
    }

    #dayInfo {
      margin-top: 20px;
      padding: 16px;
      background: #15192d;
      border-radius: 12px;
    }

    #lunarGuidance {
      background: #15192d;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    #toggleGuidance {
      margin-top: 8px;
      background: none;
      border: 1px solid #888;
      color: #eee;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h1>ðŸŒ™ 13 Moon Calendar</h1>

<div id="lunarGuidance">
  <h2>Todayâ€™s Lunar Guidance</h2>
  <button id="toggleGuidance">Open</button>

  <div id="guidanceContent" hidden>
    <p id="lunarPhase"></p>
    <p><strong>Affirmation</strong><br><span id="affirmation"></span></p>
    <p><strong>Suggested Ritual</strong><br><span id="ritual"></span></p>
    <p><strong>Journal Prompt</strong><br><span id="journal"></span></p>
  </div>
</div>

<div id="calendar"></div>

<div id="dayInfo">
  <h2>Selected Day</h2>
  <p id="dayText">Tap a day to receive its guidance.</p>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const calendar = document.getElementById("calendar");
  const dayText = document.getElementById("dayText");

  const MS_PER_DAY = 86400000;
  const LUNAR_MONTH = 28;

  // Anchored to a real New Moon
  const LUNAR_ANCHOR = new Date(2024, 0, 11);

  const MOON_ARCHETYPES = [
    "Initiation","Stability","Growth","Harmony","Blooming",
    "Nurturing","Illumination","Transformation","Harvest",
    "Mysticism","Vision","Purification","Restoration"
  ];

  const FULL_MOON_NAMES = [
    "Wolf Moon","Snow Moon","Worm Moon","Pink Moon","Flower Moon",
    "Strawberry Moon","Buck Moon","Sturgeon Moon","Harvest Moon",
    "Hunterâ€™s Moon","Beaver Moon","Cold Moon"
  ];

  function getMoonPhase(date) {
    const p = SunCalc.getMoonIllumination(date).phase;
    if (p < 0.03 || p > 0.97) return "ðŸŒ‘ New Moon";
    if (p < 0.22) return "ðŸŒ’ Waxing Crescent";
    if (p < 0.28) return "ðŸŒ“ First Quarter";
    if (p < 0.47) return "ðŸŒ” Waxing Gibbous";
    if (p < 0.53) return "ðŸŒ• Full Moon";
    if (p < 0.72) return "ðŸŒ– Waning Gibbous";
    if (p < 0.78) return "ðŸŒ— Last Quarter";
    return "ðŸŒ˜ Waning Crescent";
  }

  function getLunarZodiac(date) {
    const pos = SunCalc.getMoonPosition(date, 0, 0);
    const lon = (pos.ra * 180 / Math.PI + 360) % 360;
    const signs = ["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];
    return signs[Math.floor(lon / 30)];
  }

  function getLunarData(date) {
    const days = Math.floor((date - LUNAR_ANCHOR) / MS_PER_DAY);
    const moonDay = ((days % LUNAR_MONTH) + LUNAR_MONTH) % LUNAR_MONTH + 1;
    const moonIndex = Math.floor(days / LUNAR_MONTH) % 13;
    return { moonDay, archetype: MOON_ARCHETYPES[moonIndex] };
  }

  const GUIDANCE = {
    1:{a:"I welcome new beginnings.",r:"Set intentions by candlelight.",j:"What am I ready to begin?"},
    7:{a:"I listen inward.",r:"Rest and reflect.",j:"What is my intuition saying?"},
    14:{a:"I stand in illuminated truth.",r:"Full Moon release ritual.",j:"What is fully seen now?"},
    28:{a:"I prepare for rebirth.",r:"Close the cycle gently.",j:"What is ready to be reborn?"}
  };

  function getGuidance(day) {
    return GUIDANCE[day] || GUIDANCE[1];
  }

  document.getElementById("toggleGuidance").onclick = () => {
    const c = document.getElementById("guidanceContent");
    c.hidden = !c.hidden;
  };

  function renderMonth(year, month) {
    calendar.innerHTML = "";

    const firstDay = new Date(year, month, 1);
    const mondayOffset = (firstDay.getDay() + 6) % 7;
    for (let i = 0; i < mondayOffset; i++) {
      calendar.appendChild(document.createElement("div"));
    }

    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const today = new Date();

    for (let d = 1; d <= daysInMonth; d++) {
      const date = new Date(year, month, d);
      const phase = getMoonPhase(date);
      const lunar = getLunarData(date);
      const zodiac = getLunarZodiac(date);
      const guidance = getGuidance(lunar.moonDay);

      const cell = document.createElement("div");
      cell.className = "day";

      if (date.toDateString() === today.toDateString()) {
        cell.classList.add("today");
        document.getElementById("lunarPhase").innerText = phase;
        document.getElementById("affirmation").innerText = guidance.a;
        document.getElementById("ritual").innerText = guidance.r;
        document.getElementById("journal").innerText = guidance.j;
      }

      const fullMoonName =
        phase === "ðŸŒ• Full Moon" ? FULL_MOON_NAMES[month] : "";

      cell.innerHTML = `
        <div class="gregorian">${date.toDateString()}</div>
        <div class="moon-name">${phase}</div>
        ${fullMoonName ? `<div class="moon-name">ðŸŒ• ${fullMoonName}</div>` : ""}
        <div class="moon-name">${lunar.archetype} Â· Day ${lunar.moonDay} Â· ðŸŒ  ${zodiac}</div>
      `;

      cell.onclick = () => {
        document.getElementById("guidanceContent").hidden = false;
        document.getElementById("lunarPhase").innerText = phase;
        document.getElementById("affirmation").innerText = guidance.a;
        document.getElementById("ritual").innerText = guidance.r;
        document.getElementById("journal").innerText = guidance.j;

        dayText.innerText =
`${date.toDateString()}
${phase}
${lunar.archetype}
Moon Day ${lunar.moonDay}
Lunar Zodiac: ${zodiac}`;
      };

      calendar.appendChild(cell);
    }
  }

  const now = new Date();
  renderMonth(now.getFullYear(), now.getMonth());

});
</script>

</body>
</html>
