<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Celestial Oracle 13 Moon</title>

  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

  <style>
    :root {
      --space-bg: #05070a;
      --nebula: linear-gradient(135deg, #1a1b3a 0%, #070812 100%);
      --gold: #d4af37;
      --mystic-purple: #6e44ff;
      --full-glow: 0 0 20px rgba(255, 245, 200, 0.6);
      --new-glow: 0 0 20px rgba(100, 150, 255, 0.4);
    }

    body {
      font-family: 'Cinzel', serif, system-ui;
      background: var(--space-bg);
      background-image: 
        radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px),
        radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px);
      background-size: 550px 550px, 350px 350px;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Mystical Tarot Card */
    #lunarCard {
      width: 100%;
      max-width: 400px;
      background: var(--nebula);
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 25px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 40px rgba(110, 68, 255, 0.3);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 30px;
    }

    #lunarCard::before {
      content: "";
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: repeating-conic-gradient(from 0deg, transparent 0deg 20deg, rgba(212, 175, 55, 0.03) 21deg 40deg);
      animation: rotate 60s linear infinite;
      z-index: 0;
    }

    @keyframes rotate { 100% { transform: rotate(360deg); } }

    .card-content { position: relative; z-index: 1; }

    #cardTitle { 
      font-size: 1.8rem; 
      color: var(--gold); 
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
      margin: 10px 0;
      text-align: center;
    }

    .card-section strong { color: var(--gold); letter-spacing: 1px; text-transform: uppercase; font-size: 0.8rem; }
    .card-section p { font-style: italic; margin-top: 5px; line-height: 1.6; }

    /* Controls */
    .controls { display: flex; gap: 20px; align-items: center; margin-bottom: 20px; }
    button { 
      background: transparent; border: 1px solid var(--gold); color: var(--gold);
      padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: rgba(212, 175, 55, 0.2); }

    /* Calendar Grid */
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      width: 100%;
      max-width: 800px;
    }

    .day {
      background: rgba(21, 25, 45, 0.8);
      border: 1px solid rgba(255,255,255,0.05);
      aspect-ratio: 1/1.2;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.3s;
      position: relative;
    }

    .day:hover { transform: scale(1.05); background: rgba(110, 68, 255, 0.2); }
    
    .day.today { border: 1.5px solid var(--mystic-purple); }
    .day.full-moon { box-shadow: var(--full-glow); border: 1px solid #fff5c8; }
    .day.new-moon { box-shadow: var(--new-glow); border: 1px solid #6496ff; }

    .day-num { position: absolute; top: 5px; left: 8px; font-size: 0.7rem; opacity: 0.5; }
    .moon-emoji { font-size: 1.4rem; }
    .zodiac-label { font-size: 0.6rem; margin-top: 4px; color: var(--gold); }

    .day-label { text-align: center; color: var(--gold); font-size: 0.7rem; padding-bottom: 10px; }
  </style>
</head>
<body>

  <div id="lunarCard">
    <div class="card-content">
      <div style="display: flex; justify-content: space-between; font-size: 0.8rem; opacity: 0.8;">
        <span id="cardPhase">ğŸŒ‘ New Moon</span>
        <span id="cardZodiac">Moon in Aries</span>
      </div>
      <h2 id="cardTitle">The Dreaming</h2>
      <div class="card-section">
        <strong>Daily Affirmation</strong>
        <p id="cardAff">I am a vessel for cosmic wisdom.</p>
      </div>
      <div class="card-section">
        <strong>Ritual</strong>
        <p id="cardRit">Whisper your secrets to a glass of water, then drink it.</p>
      </div>
      <div class="card-section">
        <strong>Journal Prompt</strong>
        <p id="cardJour">What did my dreams tell me last night?</p>
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="changeMonth(-1)">âœ¦ Previous</button>
    <h3 id="monthDisplay">Month Year</h3>
    <button onclick="changeMonth(1)">Next âœ¦</button>
  </div>

  <div id="calendar"></div>

<script>
  let viewDate = new Date();
  const LUNAR_ANCHOR = new Date(2024, 0, 11);
  
  const ARCHETYPES = ["Deep Rest","Dreaming","Gestation","Stirring","Rooting","Leafing","Budding","Flowering","Radiance","Fruiting","Harvest","Composting","Stillness"];
  const ZODIAC = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];
  const MOONS = [
    { name: "Wolf Moon", emoji: "ğŸºğŸŒ•" }, { name: "Snow Moon", emoji: "â„ï¸ğŸŒ•" }, { name: "Worm Moon", emoji: "ğŸª±ğŸŒ•" },
    { name: "Pink Moon", emoji: "ğŸŒ¸ğŸŒ•" }, { name: "Flower Moon", emoji: "ğŸŒ¼ğŸŒ•" }, { name: "Strawberry Moon", emoji: "ğŸ“ğŸŒ•" },
    { name: "Buck Moon", emoji: "ğŸ¦ŒğŸŒ•" }, { name: "Sturgeon Moon", emoji: "ğŸŸğŸŒ•" }, { name: "Harvest Moon", emoji: "ğŸŒ¾ğŸŒ•" },
    { name: "Hunterâ€™s Moon", emoji: "ğŸ¹ğŸŒ•" }, { name: "Beaver Moon", emoji: "ğŸ¦«ğŸŒ•" }, { name: "Cold Moon", emoji: "ğŸ¥¶ğŸŒ•" }
  ];

  const GUIDANCE = {
    Affirmations: ["I flow with the tide.", "Magic lives in my breath.", "I am grounded in starlight.", "My intuition is my compass."],
    Rituals: ["Burn a bay leaf with a wish.", "Salt your doorway for protection.", "Meditate for 13 minutes in silence.", "Charge a crystal on your windowsill."],
    Prompts: ["What is blooming in my shadow?", "How can I honor my rest?", "Where is my energy leaking?", "What cycle is ending today?"]
  };

  function getMoonData(date) {
    const p = SunCalc.getMoonIllumination(date).phase;
    let name = "Waning Crescent";
    let emoji = "ğŸŒ˜";
    if (p < 0.03 || p > 0.97) { name = "New Moon"; emoji = "ğŸŒ‘"; }
    else if (p < 0.22) { name = "Waxing Crescent"; emoji = "ğŸŒ’"; }
    else if (p < 0.28) { name = "First Quarter"; emoji = "ğŸŒ“"; }
    else if (p < 0.47) { name = "Waxing Gibbous"; emoji = "ğŸŒ”"; }
    else if (p < 0.53) { name = "Full Moon"; emoji = "ğŸŒ•"; }
    else if (p < 0.72) { name = "Waning Gibbous"; emoji = "ğŸŒ–"; }
    else if (p < 0.78) { name = "Last Quarter"; emoji = "ğŸŒ—"; }

    const pos = SunCalc.getMoonPosition(date, 0, 0);
    const lon = (pos.lng * 180 / Math.PI + 360) % 360;
    const zodiacSign = ZODIAC[Math.floor(lon / 30)];

    const days = Math.floor((date - LUNAR_ANCHOR) / 86400000);
    const arch = ARCHETYPES[((Math.floor(days / 28) % 13) + 13) % 13];
    
    return { name, emoji, zodiacSign, archetype: arch, day: ((days % 28) + 28) % 28 + 1 };
  }

  function selectDay(date) {
    const data = getMoonData(date);
    const card = document.getElementById("lunarCard");
    card.style.opacity = 0;
    
    setTimeout(() => {
      document.getElementById("cardTitle").innerText = `${data.archetype} (Day ${data.day})`;
      document.getElementById("cardPhase").innerText = `${data.emoji} ${data.name}`;
      document.getElementById("cardZodiac").innerText = `Moon in ${data.zodiacSign}`;
      
      // Randomize guidance based on date as a seed
      const seed = date.getDate();
      document.getElementById("cardAff").innerText = GUIDANCE.Affirmations[seed % 4];
      document.getElementById("cardRit").innerText = GUIDANCE.Rituals[(seed + 1) % 4];
      document.getElementById("cardJour").innerText = GUIDANCE.Prompts[(seed + 2) % 4];
      
      card.style.opacity = 1;
    }, 300);
  }

  function render() {
    const cal = document.getElementById("calendar");
    cal.innerHTML = "";
    
    const year = viewDate.getFullYear();
    const month = viewDate.getMonth();
    document.getElementById("monthDisplay").innerText = viewDate.toLocaleString('default', { month: 'long', year: 'numeric' });

    ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(d => {
      const el = document.createElement("div"); el.className = "day-label"; el.innerText = d; cal.appendChild(el);
    });

    const firstDay = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    let offset = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

    for(let i=0; i<offset; i++) cal.appendChild(document.createElement("div"));

    for(let d=1; d<=daysInMonth; d++) {
      const date = new Date(year, month, d);
      const data = getMoonData(date);
      const cell = document.createElement("div");
      cell.className = "day";
      if(date.toDateString() === new Date().toDateString()) cell.classList.add("today");
      if(data.name === "Full Moon") cell.classList.add("full-moon");
      if(data.name === "New Moon") cell.classList.add("new-moon");

      cell.onclick = () => selectDay(date);
      cell.innerHTML = `
        <span class="day-num">${d}</span>
        <span class="moon-emoji">${data.emoji}</span>
        <span class="zodiac-label">${data.zodiacSign}</span>
      `;
      cal.appendChild(cell);
    }
  }

  function changeMonth(dir) {
    viewDate.setMonth(viewDate.getMonth() + dir);
    render();
  }

  render();
  selectDay(new Date());
</script>
</body>
</html>

