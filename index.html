<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>13 Moon Calendar</title>

  <!-- SunCalc for real lunar astronomy -->
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0b0d17;
      color: #eee;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 12px;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 12px;
    }

    .day {
      background: #15192d;
      border-radius: 10px;
      padding: 8px;
      min-height: 90px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .day:hover {
      background: #1f2550;
    }

    .day.today {
      border: 1px solid rgba(180,200,255,0.6);
      box-shadow: 0 0 12px rgba(180,200,255,0.6);
    }

    .gregorian {
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .moon-name {
      font-size: 0.75rem;
      opacity: 0.85;
      margin-top: 4px;
    }

    #dayInfo {
      margin-top: 20px;
      padding: 16px;
      background: #15192d;
      border-radius: 12px;
    }

#lunarCard {
  background: linear-gradient(180deg, #1b1f3b, #0b0d17);
  border-radius: 18px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 0 20px rgba(180,200,255,0.15);
  border: 1px solid rgba(255,255,255,0.08);
}

.card-header {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  opacity: 0.85;
  
    const todayZodiac = getLunarZodiac(today, userLat, userLon);

document.getElementById("cardZodiac").innerText =
  `ðŸŒŒ Moon in ${todayZodiac}`;
}

#cardTitle {
  text-align: center;
  margin: 12px 0;
  font-size: 1.3rem;
  letter-spacing: 0.5px;
}

.card-section {
  margin-top: 10px;
  line-height: 1.4;
}

    #toggleGuidance {
      margin-top: 8px;
      background: none;
      border: 1px solid #888;
      color: #eee;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    
    /* ðŸŒŸ Sacred Highlights */
.day.today {
  border: 1px solid rgba(180,200,255,0.9);
  box-shadow:
    0 0 12px rgba(180,200,255,0.8),
    inset 0 0 12px rgba(180,200,255,0.2);
}

.day.full-moon {
  box-shadow:
    0 0 22px rgba(255,220,180,0.9),
    inset 0 0 14px rgba(255,240,220,0.25);
}

.day.new-moon {
  box-shadow:
    0 0 20px rgba(120,140,255,0.85),
    inset 0 0 14px rgba(120,140,255,0.25);
}

.day.sacred {
  border: 1px dashed rgba(255,255,255,0.35);
}

  </style>
</head>

<body>

<h1>ðŸŒ™ 13 Moon Calendar</h1>

<div id="lunarCard">
  <div class="card-header">
    <span id="cardPhase"></span>
    <span id="cardZodiac"></span>
  </div>

  <h2 id="cardTitle"></h2>

  <p class="card-section">
    <strong>Affirmation</strong><br>
    <span id="cardAffirmation"></span>
  </p>

  <p class="card-section">
    <strong>Ritual</strong><br>
    <span id="cardRitual"></span>
  </p>

  <p class="card-section">
    <strong>Journal</strong><br>
    <span id="cardJournal"></span>
  </p>
</div>

<div id="calendar"></div>

<div id="dayInfo">
  <h2>Selected Day</h2>
  <p id="dayText">Tap a day to receive its guidance.</p>
</div>

<script>

  const calendar = document.getElementById("calendar");
  const dayText = document.getElementById("dayText");

  const MS_PER_DAY = 86400000;
  const LUNAR_MONTH = 28;
  const LUNAR_ANCHOR = new Date(2024, 0, 11);

  const MOON_ARCHETYPES = [
    "Deep Rest","Dreaming","Gestation","Stirring","Rooting",
    "Leafing","Budding","Flowering","Radiance",
    "Fruiting","Harvest","Composting","Stillness"
  ];

  const FULL_MOON_NAMES = [
    { name: "Wolf Moon", emoji: "ðŸºðŸŒ•" },
    { name: "Snow Moon", emoji: "â„ï¸ðŸŒ•" },
    { name: "Worm Moon", emoji: "ðŸª±ðŸŒ•" },
    { name: "Pink Moon", emoji: "ðŸŒ¸ðŸŒ•" },
    { name: "Flower Moon", emoji: "ðŸŒ¼ðŸŒ•" },
    { name: "Strawberry Moon", emoji: "ðŸ“ðŸŒ•" },
    { name: "Buck Moon", emoji: "ðŸ¦ŒðŸŒ•" },
    { name: "Sturgeon Moon", emoji: "ðŸŸðŸŒ•" },
    { name: "Harvest Moon", emoji: "ðŸŒ¾ðŸŒ•" },
    { name: "Hunterâ€™s Moon", emoji: "ðŸ¹ðŸŒ•" },
    { name: "Beaver Moon", emoji: "ðŸ¦«ðŸŒ•" },
    { name: "Cold Moon", emoji: "ðŸ¥¶ðŸŒ•" }
  ];

  const PHASE_EMOJI = {
    "New Moon": "ðŸŒ‘",
    "Waxing Crescent": "ðŸŒ’",
    "First Quarter": "ðŸŒ“",
    "Waxing Gibbous": "ðŸŒ”",
    "Full Moon": "ðŸŒ•",
    "Waning Gibbous": "ðŸŒ–",
    "Last Quarter": "ðŸŒ—",
    "Waning Crescent": "ðŸŒ˜"
  };

  const LUNAR_ZODIAC = [
  { sign: "Aries", start: 0 },
  { sign: "Taurus", start: 30 },
  { sign: "Gemini", start: 60 },
  { sign: "Cancer", start: 90 },
  { sign: "Leo", start: 120 },
  { sign: "Virgo", start: 150 },
  { sign: "Libra", start: 180 },
  { sign: "Scorpio", start: 210 },
  { sign: "Sagittarius", start: 240 },
  { sign: "Capricorn", start: 270 },
  { sign: "Aquarius", start: 300 },
  { sign: "Pisces", start: 330 }
];

  function getLunarZodiac(date, lat, lon) {
  const pos = SunCalc.getMoonPosition(date, lat, lon);

  // Convert radians â†’ degrees
  let eclipticLongitude = (pos.lon * 180 / Math.PI + 360) % 360;

  for (let i = LUNAR_ZODIAC.length - 1; i >= 0; i--) {
    if (eclipticLongitude >= LUNAR_ZODIAC[i].start) {
      return LUNAR_ZODIAC[i].sign;
    }
  }
  return "Pisces";
}

  function getMoonPhase(date) {
    const p = SunCalc.getMoonIllumination(date).phase;
    if (p < 0.03 || p > 0.97) return "New Moon";
    if (p < 0.22) return "Waxing Crescent";
    if (p < 0.28) return "First Quarter";
    if (p < 0.47) return "Waxing Gibbous";
    if (p < 0.53) return "Full Moon";
    if (p < 0.72) return "Waning Gibbous";
    if (p < 0.78) return "Last Quarter";
    return "Waning Crescent";
  }

  function getLunarData(date) {
    const days = Math.floor((date - LUNAR_ANCHOR) / MS_PER_DAY);
    const moonDay = ((days % LUNAR_MONTH) + LUNAR_MONTH) % LUNAR_MONTH + 1;
    const moonIndex = Math.floor(days / LUNAR_MONTH) % 13;
    return { moonDay, archetype: MOON_ARCHETYPES[moonIndex] };
  }

  function getMoonDayGuidance(day) {
    return {
      a: "I move in rhythm with the living cosmos.",
      r: "Light a candle and sit beneath the sky for three breaths.",
      j: "Where am I being asked to soften today?"
    };
  }

  function isEquinoxOrSolstice(date) {
    const m = date.getMonth(), d = date.getDate();
    if (m === 2 && d >= 19 && d <= 21) return "âš– Spring Equinox";
    if (m === 5 && d >= 20 && d <= 22) return "â˜€ï¸ Summer Solstice";
    if (m === 8 && d >= 21 && d <= 23) return "ðŸ‚ Autumn Equinox";
    if (m === 11 && d >= 20 && d <= 22) return "â„ï¸ Winter Solstice";
    return "";
  }

  function renderMonth(year, month) {
    calendar.innerHTML = "";
    const firstDay = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const offset = (firstDay.getDay() + 6) % 7;

    for (let i = 0; i < offset; i++) {
      calendar.appendChild(document.createElement("div"));
    }

    for (let d = 1; d <= daysInMonth; d++) {
      const date = new Date(year, month, d);
      const phase = getMoonPhase(date);
      const lunar = getLunarData(date);
      const phaseEmoji = PHASE_EMOJI[phase];
      const fullMoon = phase === "Full Moon" ? FULL_MOON_NAMES[month % 12] : null;
      const sacred = isEquinoxOrSolstice(date);

     const zodiac = getLunarZodiac(date, userLat, userLon);

cell.classList.add("day");

if (date.toDateString() === today.toDateString()) {
  cell.classList.add("today");
}

if (phase === "Full Moon") {
  cell.classList.add("full-moon");
}

if (phase === "New Moon") {
  cell.classList.add("new-moon");
}

if (sacred) {
  cell.classList.add("sacred");
}

cell.innerHTML = `
  <div class="gregorian">${date.toDateString()}</div>
  <div class="moon-day">${phaseEmoji} ${phase}</div>
  ${fullMoon ? `<div class="moon-name">${fullMoon.emoji} ${fullMoon.name}</div>` : ""}
  <div class="moon-name">ðŸŒŒ Moon in ${zodiac}</div>
  <div class="moon-name">${lunar.archetype} Â· Day ${lunar.moonDay}</div>
  ${sacred ? `<div class="moon-name">${sacred}</div>` : ""}
`;

      cell.onclick = () => {
        dayText.innerText =
`${date.toDateString()}
${phaseEmoji} ${phase}
${fullMoon ? fullMoon.name : ""}
${lunar.archetype} Â· Moon Day ${lunar.moonDay}`;
      };

      calendar.appendChild(cell);
    }
  }

  const today = new Date();
  const lunar = getLunarData(today);
  const phase = getMoonPhase(today);
  const guidance = getMoonDayGuidance(lunar.moonDay);

  document.getElementById("cardTitle").innerText =
    `${lunar.archetype} â€” ${phase}`;
  document.getElementById("cardPhase").innerText =
    `${PHASE_EMOJI[phase]} ${phase}`;
  document.getElementById("cardZodiac").innerText =
    `Moon Day ${lunar.moonDay}`;

  document.getElementById("cardAffirmation").innerText = guidance.a;
  document.getElementById("cardRitual").innerText = guidance.r;
  document.getElementById("cardJournal").innerText = guidance.j;

  document.addEventListener("DOMContentLoaded", () => {
let userLat = 0;
let userLon = 0;

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(
    pos => {
      userLat = pos.coords.latitude;
      userLon = pos.coords.longitude;
      renderMonth(new Date().getFullYear(), new Date().getMonth());
    },
    () => {
      // graceful fallback: Earth center reference
      userLat = 0;
      userLon = 0;
    }
  );
}
    
  renderMonth(today.getFullYear(), today.getMonth());
});
</script>

</body>
</html>
