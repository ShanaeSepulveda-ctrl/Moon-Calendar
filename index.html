<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>The Ancient Rhythm</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Charm:wght@400;700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
  <style>
    :root { 
      --space: #020105; --gold: #e6ccff; --glass: rgba(12, 6, 24, 0.96); 
      --blood: #ff3385; --aura: #9d50bb; --amethyst: #df80ff;
      --retro: #ff6b6b; --portal: #ffd700; --moon-glow: #a8e6cf; --zodiac: #99ccff; --phase: #b388ff;
    }
    body { 
      font-family: 'Quicksand', sans-serif; background: var(--space); 
      background-image: radial-gradient(circle at top, #1a0b2e 0%, var(--space) 100%); 
      color: #fdfbff; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden;
    }
    
    /* STAR FIELD */
    .star-field { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) infinite ease-in-out; box-shadow: 0 0 4px rgba(255, 255, 255, 0.8); }
    @keyframes twinkle { 
      0%, 100% { opacity: 0.2; transform: scale(0.8); } 
      50% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 8px rgba(255, 255, 255, 1); } 
    }

    #oracleDash, #grimoireView, #yearlyView, #libraryView { 
      width: 92%; max-width: 450px; background: var(--glass); backdrop-filter: blur(30px); 
      border: 1px solid rgba(230, 204, 255, 0.1); border-top: 3px solid var(--aura); 
      border-radius: 35px; padding: 20px; margin: 15px 0; box-shadow: 0 15px 50px rgba(0,0,0,0.9); text-align: center; display: none; position: relative;
    }
    #oracleDash { display: block; }

    /* MODAL */
    #cosmicModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background: rgba(15, 5, 25, 0.98); border: 2px solid var(--gold); border-radius: 25px; padding: 25px; z-index: 1000; text-align: left; box-shadow: 0 0 50px rgba(200, 180, 255, 0.3); max-height: 80vh; overflow-y: auto; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; }
    
    .modal-section { margin-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
    .modal-section:last-child { border-bottom: none; }
    .modal-label { font-family: 'Cinzel'; font-size: 0.7rem; color: var(--gold); letter-spacing: 2px; display: block; margin-bottom: 8px; font-weight: bold; }
    .modal-content-text { font-family: 'Charm'; font-size: 1.2rem; color: #fff; line-height: 1.5; }

    /* CALENDAR GRID */
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 450px; margin-bottom: 10px; }
    .day-label { font-size: 0.55rem; color: var(--gold); font-family: 'Cinzel'; opacity: 0.6; }
    .day { background: rgba(255,255,255,0.02); border-radius: 10px; aspect-ratio: 1/1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 1.5px solid transparent; cursor: pointer; transition: 0.3s; }
    .day.today { border: 2.5px solid var(--gold); box-shadow: 0 0 15px var(--gold); z-index: 2; }
    .day.full-moon-day { background: radial-gradient(circle, rgba(230, 204, 255, 0.3) 0%, transparent 70%); }
    .day.new-moon-day { background: radial-gradient(circle, rgba(75, 0, 130, 0.4) 0%, transparent 70%); }
    .day.celestial-pivot { border: 1.5px dashed var(--gold); }
    .day.selected { border: 1px solid #fff; background: rgba(255, 255, 255, 0.1); }
    .day.period { border-bottom: 3px solid var(--blood) !important; }

    .d-num { position: absolute; top: 4px; left: 6px; font-size: 0.55rem; opacity: 0.4; }
    .t-num { position: absolute; top: 4px; right: 6px; font-size: 0.55rem; color: var(--gold); font-weight: bold; }
    .m-ico { font-size: 1rem; margin-top: 5px; filter: drop-shadow(0 0 5px var(--aura)); }
    .z-ico { font-size: 0.45rem; color: var(--gold); margin-top: 2px; font-family: 'Cinzel'; }

    /* NAVIGATION */
    .nav-container { display: flex; justify-content: space-between; width: 92%; max-width: 450px; flex-wrap: wrap; gap: 5px; }
    .nav-btn { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--gold); border-radius: 15px; padding: 8px; font-family: 'Cinzel'; font-size: 0.55rem; cursor: pointer; white-space: nowrap; }
    
    .cycle-btn { border: 1.5px solid var(--blood); color: var(--blood); background: transparent; padding: 14px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.8rem; width: 100%; margin-top: 15px; transition: 0.3s; }
    .cycle-btn.active { background: var(--blood); color: white; box-shadow: 0 0 15px var(--blood); }
    .sister-btn { background: rgba(255,255,255,0.05); color: var(--gold); border: 1px solid var(--aura); padding: 10px; border-radius: 30px; cursor: pointer; font-family: 'Cinzel'; font-size: 0.65rem; width: 100%; margin-top: 10px; }
    .explore-btn { background: var(--gold); color: var(--space); border: none; padding: 10px 25px; border-radius: 20px; font-family: 'Cinzel'; font-size: 0.75rem; margin-top: 15px; cursor: pointer; text-decoration: none; display: inline-block; box-shadow: 0 0 15px var(--gold); }

    .wisdom-card { text-align: left; background: rgba(0,0,0,0.4); padding: 20px; border-radius: 25px; border-left: 3px solid var(--aura); margin-bottom: 15px; }
    .wisdom-label { font-family: 'Cinzel'; font-size: 0.6rem; color: var(--gold); letter-spacing: 2px; display: block; margin-bottom: 8px; }
    .wisdom-text { font-family: 'Charm'; font-size: 1.15rem; line-height: 1.6; color: #eee; }
    .affirmation { font-family: 'Cinzel'; font-size: 0.7rem; color: var(--gold); margin-top: 12px; opacity: 0.8; font-style: italic; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px;}
    
    #journalInput { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; color: #fff; font-family: 'Charm'; font-size: 1.2rem; min-height: 100px; box-sizing: border-box; outline: none; }
    
    .event-badge { font-size: 0.6rem; padding: 6px 15px; border-radius: 15px; display: inline-block; margin-bottom: 8px; font-family: 'Cinzel'; letter-spacing: 1px; cursor: pointer; transition: 0.3s; position: relative; }
    .event-badge:hover { transform: scale(1.05); filter: brightness(1.2); }
    .event-badge::after { content: " ‚Üó"; font-family: sans-serif; opacity: 0.7; }
    
    .portal-badge { background: var(--portal); color: var(--space); box-shadow: 0 0 10px var(--portal); }
    .retro-badge { background: var(--retro); color: var(--space); box-shadow: 0 0 10px var(--retro); }
    .newyear-badge { background: linear-gradient(90deg, #2ecc71, #df80ff); color: white; box-shadow: 0 0 20px #2ecc71; padding: 8px 20px; font-size: 0.75rem; border: 1px solid white; cursor: pointer;}
    
    .clickable-title { 
      cursor: pointer; transition: all 0.4s ease; position: relative; display: inline-block;
      text-shadow: 0 0 10px rgba(230, 204, 255, 0.3); padding: 12px 30px;
      background: rgba(230, 204, 255, 0.05); border: 1px solid rgba(230, 204, 255, 0.25);
      border-radius: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .clickable-title:hover { 
      text-shadow: 0 0 20px var(--gold), 0 0 40px var(--aura); transform: scale(1.03) translateY(-3px);
      color: #fff; background: rgba(230, 204, 255, 0.12); border-color: var(--gold);
      box-shadow: 0 10px 25px rgba(230, 204, 255, 0.3), inset 0 0 15px rgba(230, 204, 255, 0.1);
    }

    .grim-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px; }
    .grim-btn { background: transparent; border: none; color: #aaa; font-size: 0.9rem; cursor: pointer; }
    .support-link { margin-top: 20px; font-size: 0.7rem; color: var(--gold); opacity: 0.7; cursor: pointer; text-decoration: underline; font-family: 'Cinzel'; display: block; }
    
    /* LIBRARY STYLES - SIDE BY SIDE */
    .lib-section { margin-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; text-align: left; }
    .lib-title { color: var(--gold); font-family: 'Cinzel'; font-size: 0.8rem; margin-bottom: 10px; display: block; letter-spacing: 2px;}
    .lib-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .lib-btn { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: #ccc; padding: 12px; border-radius: 8px; font-size: 0.75rem; text-decoration: none; display: block; text-align: left; transition: 0.2s; font-family: 'Quicksand'; }
    .lib-btn:hover { background: var(--aura); color: #fff; border-color: var(--gold); }

    .clickable-event { cursor: pointer; transition: 0.2s; }
    .clickable-event:hover { background: rgba(255,255,255,0.05); border-radius: 5px; padding-left: 5px; }

    .backup-section { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px; padding-top: 20px; }
    .backup-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--gold); padding: 12px; border-radius: 10px; font-family: 'Cinzel'; font-size: 0.7rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; width: 100%;}
    .backup-btn:hover { background: rgba(255,255,255,0.1); }
  </style>
</head>
<body>

<div class="star-field" id="starField"></div>

<div class="nav-container">
  <button class="nav-btn" onclick="showView('yearly')">YEARLY MAP</button>
  <button class="nav-btn" onclick="showView('grimoire')">MY HISTORY</button>
  <button class="nav-btn" onclick="showView('library')">WISDOM LIBRARY</button>
</div>

<div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 450px; margin: 10px 0;">
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(-1)">‚òæ</span>
  <h3 id="monthLabel" style="font-family:'Cinzel'; letter-spacing: 4px; margin:0; font-size: 1rem;"></h3>
  <span style="cursor:pointer; font-size: 2rem; color:var(--gold);" onclick="changeMonth(1)">‚òΩ</span>
</div>

<div id="calendar"></div>

<div id="oracleDash">
  <div id="eventDisplay"></div>
  <h2 id="dashTitle" class="clickable-title" style="font-family:'Cinzel'; margin: 25px 0 5px 0; color:var(--gold); letter-spacing: 3px; font-size: 1.4rem;"></h2>
  <div id="dashSub" style="font-size: 0.6rem; letter-spacing: 2px; margin-bottom: 30px; opacity: 0.8; font-family: 'Cinzel';"></div>
  
  <div class="wisdom-card">
    <span class="wisdom-label">ANCESTRAL WHISPER</span>
    <div class="wisdom-text" id="guidanceText"></div>
    <div class="affirmation" id="affirmationText"></div>
  </div>

  <div class="wisdom-card" id="shadowCard" style="display:none; border-left: 3px solid var(--retro);">
    <span class="wisdom-label" style="color:var(--retro);">SHADOW WORK INQUIRY</span>
    <div class="wisdom-text" id="shadowText"></div>
  </div>

  <div class="wisdom-card">
    <span class="wisdom-label">SACRED EARTH RITUAL</span>
    <div class="wisdom-text" id="ritualText"></div>
  </div>

  <textarea id="journalInput" placeholder="Scribe your soul's journey..." oninput="saveData()"></textarea>
  
  <div style="display: flex; flex-direction: column; gap: 5px;">
    <button id="flowBtn" class="cycle-btn" onclick="toggleFlow()">MARK MOON FLOW</button>
    <button class="sister-btn" onclick="copySisterReport()">
      <span>‚ú®</span> SHARE MOON REPORT <span>‚ú®</span>
    </button>
  </div>
</div>

<div class="modal-overlay" onclick="closeModal()"></div>
<div id="cosmicModal">
  <h2 id="modalTitle" style="font-family:'Cinzel'; color:var(--gold); text-align:center; border-bottom: 1px solid var(--gold); padding-bottom:10px; margin-bottom:15px;"></h2>
  <div id="modalContent"></div>
  <div style="text-align:center; margin-top:20px;">
      <button class="explore-btn" onclick="closeModal()">CLOSE</button>
  </div>
</div>

<div id="grimoireView">
  <span style="float:right; cursor:pointer;" onclick="showView('dash')">‚úï</span>
  <h2 style="font-family:'Cinzel';">MY SACRED HISTORY</h2>
  <div style="font-size:0.6rem; margin-bottom:10px; opacity:0.6;">Your journey is sacred. Export to view your patterns.</div>
  
  <div class="backup-section">
    <span class="backup-title">DATA MANAGEMENT</span>
    <button class="backup-btn export-btn" onclick="exportToCSV()">üìä EXPORT SPREADSHEET (READABLE)</button>
    <div style="text-align:center; font-family:'Cinzel'; font-size:0.6rem; color:var(--gold); opacity:0.7; margin-top:5px;">‚úì Auto-saving to this device</div>
  </div>
  
  <div id="grimoireContent" style="max-height: 350px; overflow-y: auto; margin-top: 15px;"></div>
  <a class="support-link" href="https://ko-fi.com/theancientrhythm" target="_blank">Created with Love ‚Ä¢ Support the Journey</a>
</div>

<div id="yearlyView">
  <span style="float:right; cursor:pointer;" onclick="showView('dash')">‚úï</span>
  <h2 style="font-family:'Cinzel'; font-size: 1rem;">CELESTIAL TIMELINE</h2>
  <div id="yearlyContent" style="text-align: left; padding: 10px; font-size: 0.75rem;"></div>
</div>

<div id="libraryView">
  <span style="float:right; cursor:pointer;" onclick="showView('dash')">‚úï</span>
  <h2 style="font-family:'Cinzel'; font-size: 1.2rem; margin-bottom: 20px;">WISDOM LIBRARY</h2>
  <div id="libraryContent"></div>
</div>

<script>
  let activeD = new Date(2026, 0, 16); 
  let selectedDate = new Date().toDateString();
  let db = JSON.parse(localStorage.getItem('ancestral_moon_v89')) || { logs: {}, journals: {}, zodCache: {}, energy: {} };

  const ELEMENTS = { "FIRE": "#ff4d4d", "EARTH": "#2ecc71", "AIR": "#3498db", "WATER": "#df80ff" };
  const ZOD_ELEMENTS = { "Aries ‚ôà":"FIRE", "Leo ‚ôå":"FIRE", "Sagittarius ‚ôê":"FIRE", "Taurus ‚ôâ":"EARTH", "Virgo ‚ôç":"EARTH", "Capricorn ‚ôë":"EARTH", "Gemini ‚ôä":"AIR", "Libra ‚ôé":"AIR", "Aquarius ‚ôí":"AIR", "Cancer ‚ôã":"WATER", "Scorpio ‚ôè":"WATER", "Pisces ‚ôì":"WATER" };
  
  const SUN_SIGN_DATA = {
    "Aries": "THE SEASON OF ACTION. The world wakes up. Fire energy.",
    "Taurus": "THE SEASON OF GROUNDING. Roots go deep. Earth energy.",
    "Gemini": "THE SEASON OF CONNECTION. Ideas flow. Air energy.",
    "Cancer": "THE SEASON OF FEELING. Emotional depth. Water energy.",
    "Leo": "THE SEASON OF RADIANCE. Shine bright. Fire energy.",
    "Virgo": "THE SEASON OF REFINEMENT. Order and harvest. Earth energy.",
    "Libra": "THE SEASON OF BALANCE. Relationships focus. Air energy.",
    "Scorpio": "THE SEASON OF TRANSFORMATION. Deep waters. Water energy.",
    "Sagittarius": "THE SEASON OF EXPANSION. Seeking truth. Fire energy.",
    "Capricorn": "THE SEASON OF BUILDING. Structure and ambition. Earth energy.",
    "Aquarius": "THE SEASON OF VISION. Innovation and future. Air energy.",
    "Pisces": "THE SEASON OF DREAMS. Spirituality and surrender. Water energy."
  };

  const SUN_SIGN_DATES = {
    "Aries": "Mar 21 - Apr 19",
    "Taurus": "Apr 20 - May 20",
    "Gemini": "May 21 - Jun 20",
    "Cancer": "Jun 21 - Jul 22",
    "Leo": "Jul 23 - Aug 22",
    "Virgo": "Aug 23 - Sep 22",
    "Libra": "Sep 23 - Oct 22",
    "Scorpio": "Oct 23 - Nov 21",
    "Sagittarius": "Nov 22 - Dec 21",
    "Capricorn": "Dec 22 - Jan 19",
    "Aquarius": "Jan 20 - Feb 18",
    "Pisces": "Feb 19 - Mar 20"
  };

  const DAILY_WISDOM_LIBRARY = {
    "Aries": { 
      "Waxing": ["The spark has caught the wind. You are not waiting for permission; you are the permission. Act before the impulse cools.", "The ancestors lend you their iron will today. Push through the inertia. The only way out is through.", "Initiation requires a reckless kind of faith. Jump, and build your wings on the way down."], 
      "Waning": ["Lay down your sword. The war is over for today. Your strength now lies in your capacity to rest without apology.", "The fire burns low, warming the hearth instead of the battlefield. Tend to your inner flame; it needs protection, not fuel.", "Shed the need to conquer. There is a victory in simply existing. Breathe into your belly and find the stillness."], 
      "Full": ["You are the bonfire on the mountain. Burn bright enough to be seen from the valley. Your existence is a signal fire.", "Claim your sovereignty. You are the author of this moment. Stand tall in your own light and let the shadows fall behind.", "A climax of will. What you desire is rushing toward you. Do not flinch. Open your arms and receive the heat."], 
      "New": ["In the velvet dark, a new seed of courage is planted. Do not rush the sprouting. Strength gathers in the silence.", "The void is electric with potential. You are being re-wired for bravery. Rest in the darkness before the dawn.", "Silence before the strike. The arrow is being pulled back. Trust the tension; it promises distance."] 
    },
    "Taurus": { 
      "Waxing": ["Build your life like a cathedral‚Äîstone by stone, with absolute reverence. There is no rush when you are building for eternity.", "The earth supports your weight. Lean into the process. Growth is not a race; it is a deepening of roots.", "Solidify your dreams. Make them tangible. Touch the earth, eat good food, and remind your spirit it has a home."], 
      "Waning": ["Release the clutter. You cannot receive the new harvest if your hands are full of yesterday's withered leaves.", "Compost what is heavy. Let the earth metabolize your grief and turn it into fuel for the coming spring.", "The season of shedding. Let go of the stubborn need to control. Yielding to the cycle is the ultimate strength."], 
      "Full": ["Your body is the altar. Feast on the present moment. If it does not bring deep, resonant pleasure, why are you holding it?", "Abundance is not a number; it is a feeling in the bones. Soak in the richness of your life right now.", "The garden is in full bloom. Stop working and start admiring. You have grown a life of beauty; pause to smell it."], 
      "New": ["Plant your intentions in the dark, rich soil of silence. Do not dig them up to check on them. Trust the dark.", "Rest in the embrace of the Great Mother. You are safe here. You are held. You do not need to strive.", "A quiet germination. Seeds of wealth and worthiness are awakening underground. Sleep, and let them grow."] 
    },
    "Gemini": { 
      "Waxing": ["Your words are spells today. Speak only what you wish to become true. The air is listening to your command.", "Follow the golden thread of curiosity. It may seem like a distraction, but it is leading you to a necessary door.", "Connect the dots. Your mind is a loom, weaving disparate threads into a tapestry of understanding."], 
      "Waning": ["Quiet the mental storm. Let the winds die down so you can hear the birdsong. Your mind needs a Sabbath.", "Unlearn the stories that keep you small. You are the narrator, and you have the power to edit the script.", "Release the need to know the answer. Rest in the question. The mystery is a friend, not a puzzle to solve."], 
      "Full": ["Illumination strikes like lightning. The fog lifts, and you see the path clearly. Do not look away from the truth.", "Your voice is a bridge. Share your story today; someone is waiting on the other side of the river for your words.", "A whirlwind of connection. You are a node in the cosmic web. Vibrate with truth and watch the web tremble."], 
      "New": ["The air is still. A blank page lies before you. Pick up the quill. What is the first sentence of your new life?", "Plant a seed of communication. Is there a silence that needs to be broken? Resolve to speak.", "The mind is a calm lake. Drop a single intention into the center and watch the ripples touch the shore."] 
    },
    "Cancer": { 
      "Waxing": ["Protect your dream like a mother protects a child. It is too young for the harsh air of criticism. Keep it close.", "Flow with the rising water. Your intuition is a river; do not try to dam it. Let it take you where you need to go.", "Build your sanctuary. You cannot bloom if you do not feel safe. Create a soft place to land."], 
      "Waning": ["The tide goes out, taking the debris with it. Let your tears wash away the dust of the world. Cleansing is holy.", "Forgive the past, not for them, but to unchain your own ankle. You are too light to carry such heavy rocks.", "Return to the shell. It is safe to retreat. In the quiet of your inner world, you will find the pearl."], 
      "Full": ["Your heart is an ocean, vast and deep. Do not apologize for the size of your waves. Let them crash.", "The Mother shines upon you. You are the keeper of the ancient flame of comfort. Warm yourself by your own fire.", "High tide of the soul. Secrets float to the surface. Look at them with love, for they are parts of you returning home."], 
      "New": ["The womb of the universe. Floating in the dark waters of potential. You are being knit together in secret.", "Plant seeds of belonging. You are not an orphan of the cosmos; you are its beloved child. Rest in that truth.", "Retreat to the source. The crab buries itself in the sand to dream. Close your eyes and drift."] 
    },
    "Leo": { 
      "Waxing": ["The sun climbs the sky. You are asked to be visible. Do not shrink; the world needs your specific frequency of light.", "Create from the heart. Art is your prayer today. Make something beautiful, not for money, but for your soul.", "Play is a sacred act. The inner child holds the keys to the kingdom. What made you laugh when you were five?"], 
      "Waning": ["The sun sets so the stars can shine. Step back from the spotlight and find the quiet dignity of the shadows.", "Release the need for applause. Your worth is an internal gold mine, not an external currency.", "Shed the performance. Take off the mask and feel the cool night air on your true face. You are enough."], 
      "Full": ["You are the center of your universe. Radiate warmth. Your joy is a gravity that pulls good things into your orbit.", "Lead with the heart. A true queen rules with compassion, not force. Your vulnerability is your crown.", "Celebrate your existence. It is a miracle that you are here, breathing, alive. Dance in honor of your own life."], 
      "New": ["A seed of creativity glows in the dark. What masterpiece is waiting in the wings? Dream it into being.", "Set an intention for joy. Where have you become too rigid? Invite the chaotic, messy energy of delight.", "The heart beats in the silence. Listen to its rhythm. It is the drum of your destiny."] 
    },
    "Virgo": { 
      "Waxing": ["God is in the details. The small step, taken with great love, is the most powerful magic. Attend to the little things.", "Refine your vessel. Your body is the temple where the ritual happens. Treat it with exquisite care.", "Purify your intent. Ask yourself: 'Does this serve my highest good?' If not, gently prune it away."], 
      "Waning": ["Sweep the temple. Clear the dust from your mind and your floor. Outer order invites inner peace.", "Release perfectionism. It is a cage, not a shield. Embrace the crack in the vase; that is where the light gets in.", "Analyze less, feel more. The mind can dissect, but only the heart can heal. Put down the scalpel."], 
      "Full": ["The High Priestess stands tall. Your service to others is your magic, but do not forget to serve yourself first.", "Order emerges from chaos. You can see the pattern in the weaving now. Trust the design.", "Healing light floods the system. You are being repaired on a cellular level. Drink water and rest."], 
      "New": ["Plant a seed of order. Organize your inner world so that the outer world can reflect it. Peace begins in the quiet mind.", "Set an intention for health. Your body is the vessel for your magic. Ask it what it needs, and promise to listen.", "Quiet service. How can you serve your soul in the dark? Tend to your own garden before you try to feed the world."] 
    },
    "Libra": { 
      "Waxing": ["Balance is not a destination; it is a dance. Move with grace between the poles of your life.", "Beautify your path. Beauty is a high vibration that heals the spirit. Add a flower, a song, a color.", "Connect. You do not have to walk this path alone. Reach out your hand; someone is waiting to hold it."], 
      "Waning": ["Release the need to please. You cannot set yourself on fire to keep others warm. Reclaim your energy.", "Let go of indecision. Standing at the crossroads only delays the journey. Choose a path and walk it.", "Unbind yourself from expectations. Their disappointment is not your burden. Be true to your own soul."], 
      "Full": ["The mirror of relationship. What you see in others is a reflection of yourself. Look with love.", "A climax of harmony. Surround yourself with what you love. Let art, music, and softness be your armor against the hardness of the world.", "Justice and harmony. Seek the middle path in the full light. Where there is conflict, bring the medicine of listening."], 
      "New": ["Set an intention for peace. Call a ceasefire in the war against yourself. Invite tranquility in.", "Sow seeds of partnership. Call in your divine mirrors. You are ready for a higher octave of love.", "Rest in the center point. The pendulum stops swinging in the dark. Find the stillness."] 
    },
    "Scorpio": { 
      "Waxing": ["Dive. The surface is boring; the treasure is in the deep. Do not be afraid of your own intensity.", "Invest your energy fully. Scorpio asks for total commitment. Burn the boats; there is no going back.", "Trust your gut. Your intuition is a razor today. It cuts through the lies. Follow the blade."], 
      "Waning": ["Shed the skin. It is tight and dry. It no longer fits who you are becoming. Peel it off and leave it behind.", "Release the grudge. It is drinking your poison. Let it go, not for them, but so you can finally breathe.", "Compost the soul. Let the dead leaves of the past rot down into fertilizer for your future."], 
      "Full": ["The Phoenix rises. You are being reborn in the fire. Spread your wings and dry them in the sun.", "Secrets revealed. The shadow is brought into the light. Do not look away; look with compassion.", "Intense magic. Your gaze has power today. Use it to heal, to transform, to alchemize lead into gold."], 
      "New": ["The Void. Sit in the absolute dark. You are unmaking yourself so you can be remade better.", "What must die to be born? Offer it to the dark mother. She will take it and give you life.", "Plant a secret. Keep your magic hidden. Power grows best in the silence of the underground."] 
    },
    "Sagittarius": { 
      "Waxing": ["Aim higher. Your arrow can fly further than you think. Do not settle for the low-hanging fruit.", "Explore. The unknown is calling. Say yes to the adventure, even if you don't know the destination.", "Expand your vision. The ancestors are widening the path. Walk with a stride of freedom."], 
      "Waning": ["Release the dogma. You do not need to be 'right' to be true. Let go of the need to convince others.", "Simplify the quest. You are carrying too much baggage. Drop the heavy rocks and keep only the map.", "The wanderer rests. Wisdom is found in the stillness by the campfire, not just on the road."], 
      "Full": ["Truth illuminates. The big picture snaps into focus. You see the divine comedy of it all. Laugh.", "Wild celebration. Dance with the cosmos. Your spirit is too big to be contained. Let it spill out.", "The Teacher speaks. Share your wisdom. Your story is the medicine someone else is praying for."], 
      "New": ["Plant a seed of freedom. Where do you feel trapped? Chew through the leash in the dark.", "Seek the philosophy that frees you. Ask the big questions. The universe loves a seeker.", "Trust the path in the dark. You don't need to see the destination to know you are heading home."] 
    },
    "Capricorn": { 
      "Waxing": ["Climb. The air is thin, but your lungs are strong. Capricorn rewards discipline. Keep going.", "Commit. You are building a legacy. Do not look for shortcuts; look for the stones that last.", "Build the empire. Every small action is a brick. Lay it with intention. You are the architect."], 
      "Waning": ["Put down the world. You have carried it long enough. Your shoulders need to rest.", "Flow around the rock. The mountain path twists. Do not force a straight line where there is a curve.", "The Elder rests. True authority comes from silence, not busy work. Sit and survey your kingdom."], 
      "Full": ["The Summit. Look how far you have come. Breathe in the view. You earned this altitude.", "Power manifested. Own your authority. You are the CEO of your own soul. Rule with wisdom.", "Structure illuminated. See the bones of your life. Give thanks for the stability that holds you."], 
      "New": ["Blueprint in the dark. Plan the future in the silence. What legacy will you leave behind?", "What is your Great Work? Set an intention for your career and your calling.", "Ground your ambition. Root it in the earth before you try to feed the world."] 
    },
    "Aquarius": { 
      "Waxing": ["Innovate. The old way is dead. Invent the new way. The ancestors applaud your rebellion.", "Connect to the web. You are a node in a vast network of light. Send out a signal of hope.", "Break the mold. Freedom is your fuel. Do not fit into the box; burn the box."], 
      "Waning": ["Release the detachment. Come down from the ivory tower and feel the beat of the human heart.", "Just be. You do not need to be different to be special. You are unique simply because you exist.", "Clear the static. Tune your frequency to a clearer channel. The noise of the world is not your song."], 
      "Full": ["Cosmic connection. You are stardust made form. Feel the electricity of the universe in your veins.", "The Rebel shines. Stand for what you believe in, even if you stand alone. Your truth is a revolution.", "A vision of the future. You can see what is coming. Hold the torch high so others can see the way."], 
      "New": ["Download the vision. The frequency is open. Listen to the electric hum of the new age.", "Set an intention for freedom. Where do you need space? Break the chains in the dark.", "Plant a seed for the collective. Dream not just for yourself, but for the world."] 
    },
    "Pisces": { 
      "Waxing": ["Dream. The veil is gossamer thin. Listen to the whispers of the unseen. Magic is real.", "Flow. Do not push the river; float with it. Surrender control and let the current take you.", "Create from the soul. Your imagination is the workshop of reality. Paint your desires."], 
      "Waning": ["Dissolve. Let the boundaries melt. You are not the drop; you are the ocean.", "Release the illusion. Surrender to the great mystery. What you lose is only the shell; the pearl remains.", "Cleansing rain. Cry for the world. Let your tears join the waters of the earth in a sacred release."], 
      "Full": ["Mystical union. You are one with the divine. Feel the god-spark burning in your chest.", "The dreamer awakens. You know the truth without words. Trust the silent, psychic knowing.", "Ocean of light. Bathe in the spiritual waters. Let the waves of cosmic love wash you clean."], 
      "New": ["The womb of the universe. Anything is possible in the void. Drift in the potential.", "Pray. Speak to the ancestors and listen for the soft reply. You are never alone.", "Drift in the silence. Let the current take you where you need to go. Trust the water."] 
    }
  };

  const DAILY_RITUALS = {
    "Aries": ["Light a red candle. Stare into the flame until your vision blurs. Inhale the heat. Exhale fear.", "Stomp your feet on the earth. Shout 'I AM' three times. Feel the vibration rattle your bones.", "Stand in the sun. Close your eyes. Drink the fire through your eyelids. You are solar-powered."],
    "Taurus": ["Walk barefoot on the soil. Imagine roots growing from your heels. Give your heaviness to the earth.", "Eat a piece of chocolate or fruit with total slowness. Let the pleasure be a prayer of gratitude.", "Hold a river stone. Feel its cold weight. Rub your thumb over it and ground your energy."],
    "Gemini": ["Write a wish on a bay leaf. Burn it and watch the smoke carry your message to the air spirits.", "Stand in the wind. Whisper your worries to the breeze. Let the air carry them away.", "Light incense. Watch the smoke curl. Divinate messages in the shapes it forms."],
    "Cancer": ["Fill a bowl with water. Whisper your love into it. Wash your face with this blessed water.", "Take a salt bath by candlelight. Imagine the water drawing all grief out of your pores.", "Hold your hand over your heart. Feel the rhythm. Tap your chest gently and say 'I am home.'"],
    "Leo": ["Wear gold jewelry or yellow clothes. Adorn yourself like the royalty you are.", "Dance wildly to one song. Shake your hips. Let the joy rise from your belly.", "Gaze at the sunrise or sunset. Breathe in the golden light. Fill your solar plexus with it."],
    "Virgo": ["Clean one shelf or corner with intention. As you wipe the dust, say 'I clear my mind.'", "Brew herbal tea. Hold the warm cup. Thank the plants for their medicine before you sip.", "Write a list of 3 things you love about your life. Place a crystal on the list to amplify it."],
    "Libra": ["Light two candles. Sit between them. Visualize your inner scales coming into perfect balance.", "Buy or pick a flower. Place it in a vase. Stare at its symmetry and breathe in beauty.", "Ring a bell or chime. Listen to the sound fade into silence. Rest in that silence."],
    "Scorpio": ["Sit in a pitch-black room. Eyes open. Do not fear the dark; let it hold you like a velvet cloak.", "Write a secret on paper. Shred it or burn it. Release the energy of keeping it hidden.", "Fill a dark bowl with water. Stare into the black reflection. Ask your intuition a question."],
    "Sagittarius": ["Walk a path you have never taken. Look for a sign (a feather, a coin, a bird).", "Light a purple candle. Close your eyes. Visualize your mind expanding to the size of the sky.", "Stand facing the horizon. Raise your arms. Claim your freedom. Breathe in the distance."],
    "Capricorn": ["Stand in Mountain Pose. Feet wide. Feel unshakeable. You are ancient stone.", "Plant a seed in a pot. Whisper a long-term goal to it. Water it with patience.", "Hold a piece of quartz. Feel its structure. Organize your thoughts to match its clarity."],
    "Aquarius": ["Go outside at night. Look at the stars. Feel the invisible web connecting you to them.", "Open all windows. Let the cross-breeze sweep your home. Visualize stagnant energy leaving.", "Hum a low tone. Feel the vibration in your skull. Tune your frequency to the cosmic hum."],
    "Pisces": ["Listen to a recording of rain or ocean waves. Drift. Dissolve into the sound.", "Dip your feet in a bowl of warm water with flowers. Bless your feet for carrying you.", "Sleep with an amethyst under your pillow. Ask for a healing dream. Trust the night."]
  };

  const ELEMENT_MEANINGS = { "FIRE": "Action, Spirit, Passion, Transformation. Fire energy asks you to move, burn away the old, and ignite your will. It is the spark of creation.", "EARTH": "Grounding, Body, Stability, Manifestation. Earth energy asks you to root down, care for your physical vessel, and build slowly with patience.", "AIR": "Intellect, Communication, Vision, Breath. Air energy asks you to speak your truth, clarify your thoughts, and connect with ideas.", "WATER": "Emotion, Intuition, Healing, Flow. Water energy asks you to feel deeply, cleanse your spirit, and trust the mystery of the unknown." };
  const ZODIAC_WISDOM = { "Aries": "Warrior Energy. Initiation and Courage. A time to start.", "Taurus": "The Gardener. Grounding and Pleasure. A time to build.", "Gemini": "The Messenger. Connection and Wit. A time to speak.", "Cancer": "The Mother. Emotion and Safety. A time to nurture.", "Leo": "The Royal. Creativity and Joy. A time to shine.", "Virgo": "The Healer. Order and Service. A time to purify.", "Libra": "The Diplomat. Balance and Beauty. A time to relate.", "Scorpio": "The Alchemist. Depth and Transformation. A time to feel.", "Sagittarius": "The Explorer. Freedom and Truth. A time to seek.", "Capricorn": "The Architect. Ambition and Structure. A time to plan.", "Aquarius": "The Visionary. Innovation and Community. A time to dream.", "Pisces": "The Mystic. Dreams and Surrender. A time to trust." };
  const PHASE_MEANINGS = { "New Moon": "The Void. Potential and Planting. The start of the cycle.", "Waxing Crescent": "The Sprout. Courage and Growth. Taking the first step.", "First Quarter": "The Root. Action and Resistance. Overcoming obstacles.", "Waxing Gibbous": "The Bud. Refinement and perfecting. Adjusting the plan.", "Full Moon": "The Bloom. Peak energy and celebration. Illumination.", "Waning Gibbous": "The Fruit. Gratitude and Sharing. Harvesting.", "Last Quarter": "The Compost. Release and Forgiveness. Letting go.", "Waning Crescent": "The Seed. Rest and Surrender. Emptying the cup." };
  
  const PIVOT_DATA = { 
    "Mar 20": {n: "Spring Equinox", w: "The Great Turning. Rebirth.", r: "Seed Ceremony.", l: "spiritual meaning of spring equinox ostara"}, 
    "Jun 20": {n: "Summer Solstice", w: "Zenith of Light. Power.", r: "Fire Crown.", l: "spiritual meaning of summer solstice litha"}, 
    "Sep 23": {n: "Autumn Equinox", w: "Second Harvest. Balance.", r: "Release Leaf.", l: "spiritual meaning of autumn equinox mabon"}, 
    "Dec 21": {n: "Winter Solstice", w: "Womb of Night. Stillness.", r: "Return of Light.", l: "spiritual meaning of winter solstice yule"}
  };
  
  const FULL_MOON_DATA = {
    "Jan 3, 2026": {n: "Wolf Moon", w: "Endurance. Loyalty to your pack. Hunger that drives you forward. In the cold, your voice carries further. What truth have you been afraid to voice? Now is the time to throw your head back and let it out.", r: "1. Stand outside or near a window. 2. Visualize the wolf spirit beside you. 3. Howl (or hum loudly) your deepest truth to the moon. 4. Feel the vibration in your chest. 5. Affirm: 'My voice is my power.'"},
    "Feb 1, 2026": {n: "Snow Moon", w: "Purity. The world is frozen, purified by the white blanket of the Snow Moon. Underneath, life is sleeping, not dead. This moon asks for patience and deep cleansing. It is a time to freeze out the distractions and focus on the pristine clarity of your own soul.", r: "1. Gather a bowl of clean snow or ice. 2. Whisper your worries into the ice. 3. Watch it melt, transforming the hard worry into fluid water. 4. Pour the water into the earth. 5. Say: 'I dissolve what binds me.'"},
    "Mar 3, 2026": {n: "Worm Moon (Eclipse)", w: "Awakening & Eclipse. The earth softens and the shadow falls. This is a time of deep, karmic purging. The Worm Moon signals the return of life, while the Eclipse demands you release the dead weight.", r: "1. Stand barefoot on the floor or earth. 2. Pulse your toes, imagining waking up the soil. 3. Shake your whole body for 60 seconds. 4. Feel the blood rushing. 5. Say: 'I am awake. I am alive.'"},
    "Apr 1, 2026": {n: "Pink Moon", w: "Emergence. The Pink Moon is not named for its color, but for the wild ground phlox, the first flowers of spring. It is the moon of emergence and blooming. You have survived the dark; now you must risk being seen. Show your colors to the world.", r: "1. Find a pink flower or stone (or visualize pink light). 2. Anoint your forehead and heart with water. 3. Hold the object to your heart. 4. Visualize a bud opening in your chest. 5. Say: 'I bloom without apology.'"},
    "May 1, 2026": {n: "Flower Moon", w: "Abundance. The Flower Moon celebrates the fullness of potential. The world is fertile, scented, and alive. This energy supports your creativity and your sensuality. You are a garden; tend to yourself with delight.", r: "1. Create a mandala of leaves/petals (or draw one). 2. Sit in the center (or focus on the center). 3. Breathe in the energy of growth. 4. Whisper one desire into the center. 5. Say: 'I am open to receive.'"},
    "May 31, 2026": {n: "Strawberry Moon", w: "Sweetness and ripeness. The Strawberry Moon is the time of harvesting the first fruits of your labor. Life is meant to be tasted, not just observed. Savor the moment. Find the sweetness in your daily life, even in the small things.", r: "1. Eat a sweet fruit (strawberry or other) very slowly. 2. Feel the juice and texture. 3. Offer gratitude for the sweetness of life. 4. Visualize your life filling with nectar. 5. Say: 'My life is sweet and full.'"},
    "Jun 29, 2026": {n: "Buck Moon", w: "Strength. The buck's antlers are in full velvet, growing rapidly. This is the moon of masculine strength, ambition, and claiming your territory. Stand tall in your convictions. It is a time to regenerate your power and show the world who you are.", r: "1. Stand with legs wide, arms reaching up like antlers. 2. Breathe deeply into your belly. 3. Visualize energy rooting you down and pulling you up. 4. Claim your space. 5. Roar or exhale loudly: 'I am here. I am strong.'"},
    "Jul 29, 2026": {n: "Sturgeon Moon", w: "Depth. The ancient fish of the deep lakes. The Sturgeon Moon connects you to the deep, primal waters of your subconscious. You are resilient, capable of swimming against the current. Survival is in your DNA. Trust your ancient instincts.", r: "1. Submerge your hands in a bowl of water. 2. Close your eyes and imagine diving deep. 3. Ask the water: 'What do I need to know?' 4. Listen for the silence. 5. Say: 'I trust my depth.'"},
    "Aug 28, 2026": {n: "Harvest Moon (Eclipse)", w: "Gathering & Shadow. A powerful partial lunar eclipse. The Harvest Moon usually brings abundance, but this shadow asks you to look at what you have harvested that is rotten. Discard it now.", r: "1. Hold a handful of grains, rice, or seeds. 2. Name 3 things you have 'grown' this year. 3. Blow thanks into the seeds. 4. Offer them to the birds or the wind. 5. Say: 'I receive my harvest.'"},
    "Sep 26, 2026": {n: "Hunter's Moon", w: "Preparation. The fields are bare; the hunt begins. The Hunter's Moon is about preparation and release. It is a time to hunt down the habits, fears, and doubts that will not serve you in the winter. Be ruthless in clearing your path.", r: "1. Light a candle. 2. Stare at the flame. 3. Identify one habit to 'hunt' and release. 4. Blow out the candle sharply to seal the end of that habit. 5. Say: 'It is done. I am free.'"},
    "Oct 25, 2026": {n: "Beaver Moon", w: "Security. The beaver builds the dam to ensure safety. This moon asks you to secure your spiritual and physical home. Check your foundations. Do you have enough spiritual sustenance to last the winter?", r: "1. Physically clean your altar or a sacred shelf. 2. Light incense or sage to clear the air. 3. Sit in the clean space. 4. Visualize a golden shield around your home. 5. Say: 'My sanctuary is safe.'"},
    "Nov 24, 2026": {n: "Cold Moon", w: "Stillness. The nights are long, the air is sharp. The Cold Moon brings the gift of stillness. The chaos of growth has stopped; now is the time of integration. In the silence of the winter night, you can finally hear the voice of your own soul.", r: "1. Sit in total darkness for 5 minutes. 2. Do not move. 3. Find the internal light that glows when the world is dark. 4. Focus on your heartbeat. 5. Say: 'I am the light in the winter.'"},
    "Dec 23, 2026": {n: "Long Night Moon", w: "Dreaming. The midwinter moon shines on the longest nights. This is the time of dreaming. The veil between waking and sleeping is thin. Pay attention to your dreams; the ancestors are speaking to you in symbols and shadows.", r: "1. Place mugwort, lavender, or a crystal under your pillow. 2. Light a candle before bed. 3. Ask: 'Ancestors, speak to me tonight.' 4. Keep a journal by your bed. 5. Sleep with intention."},
    "Jan 22, 2027": {n: "Threshold Moon", w: "The 13th Moon. The moon that stands between the years. This is the void space, the liminal time. You are neither here nor there. It is a time of pure potential and deep, ancient wisdom. You are crossing a bridge.", r: "1. Stand in a doorway in your home. 2. Look back (the past). 3. Look forward (the future). 4. Step through with your right foot consciously. 5. Say: 'I cross the threshold with courage.'"}
  };

  const FULL_MOONS_ARRAY = [
    {d: "Jan 3, 2026", z: "Cancer ‚ôã"}, {d: "Feb 1, 2026", z: "Leo ‚ôå"}, {d: "Mar 3, 2026", z: "Virgo ‚ôç"}, {d: "Apr 1, 2026", z: "Libra ‚ôé"}, {d: "May 1, 2026", z: "Scorpio ‚ôè"}, {d: "May 31, 2026", z: "Sagittarius ‚ôê"}, {d: "Jun 29, 2026", z: "Capricorn ‚ôë"}, {d: "Jul 29, 2026", z: "Aquarius ‚ôí"}, {d: "Aug 28, 2026", z: "Pisces ‚ôì"}, {d: "Sep 26, 2026", z: "Aries ‚ôà"}, {d: "Oct 25, 2026", z: "Taurus ‚ôâ"}, {d: "Nov 24, 2026", z: "Gemini ‚ôä"}, {d: "Dec 23, 2026", z: "Cancer ‚ôã"},
    {d: "Jan 22, 2027", z: "Leo ‚ôå"} 
  ];

  const NEW_MOON_DATA = {
    "Jan 18, 2026": {s: "Capricorn", w: "Architect. New Moon in Capricorn. You are standing at the base of a new mountain. This is not a time for wild emotion, but for cold, hard strategy. What empire do you wish to build this year? Lay the cornerstone today in the silence.", r: "1. Write a 1-year goal on a stone or paper. 2. Bury it in a pot of soil (or the earth). 3. Stand over it. 4. Visualize a massive tree growing from it. 5. Say: 'I build for the future.'"},
    "Feb 17, 2026": {s: "Aquarius", w: "Visionary & Eclipse. New Moon in Aquarius. A Solar Eclipse opens a portal of destiny. The old rules are incinerated. Break the mold. This moon asks you to detach from who you were expected to be and connect with who you authentically are.", r: "1. Sit under the open sky (or a window). 2. Breathe in the cold air. 3. Visualize a lightning bolt of inspiration hitting your crown. 4. Write down the wildest idea you have. 5. Say: 'I am free.'"},
    "Mar 18, 2026": {s: "Pisces", w: "Mystic. New Moon in Pisces. The final moon of the cycle. The veil is nonexistent. You are swimming in the cosmic ocean. Surrender your logic; it cannot help you here. Trust your dreams, your intuition, and the invisible currents.", r: "1. Take a salt bath by candlelight. 2. Play no music; just listen to water. 3. Imagine dissolving into the water. 4. Ask for a vision. 5. Say: 'I surrender to the flow.'"},
    "Apr 17, 2026": {s: "Aries", w: "Spark. New Moon in Aries. The first moon of the new zodiac cycle. Absolute beginnings. The energy is raw, fast, and fiery. Do not overthink; act. Plant a seed of courage. What would you do if you knew you could not fail?", r: "1. Light a single red candle. 2. Stare at the flame until your eyes water. 3. Shout your intention out loud. 4. Feel the heat. 5. Say: 'I begin. I am.'"},
    "May 16, 2026": {s: "Taurus", w: "Garden. New Moon in Taurus. Slow down. The fire of Aries settles into the earth. Plant seeds of worthiness, abundance, and peace. This is the time to set intentions for your physical body and your financial security.", r: "1. Hold a coin and a seed in your hand. 2. Walk barefoot on the earth. 3. Plant the seed and place the coin next to it (or on your altar). 4. Say: 'I grow in value.'"},
    "Jun 15, 2026": {s: "Gemini", w: "Messenger. New Moon in Gemini. The air is buzzing with new ideas. It is time to open your mind and your throat chakra. Speak your intentions into existence. Write, talk, connect. The magic is in the word.", r: "1. Write a letter to the Universe. 2. Read it out loud to the wind. 3. Burn the letter and let the smoke carry the words. 4. Listen to the wind. 5. Say: 'My voice creates.'"},
    "Jul 14, 2026": {s: "Cancer", w: "Womb. New Moon in Cancer. We return to the source. This is the most fertile moon of the year for emotional beginnings. Plant seeds of love, family, and self-care. Nurture yourself as you would a newborn.", r: "1. Create a cozy nest with pillows/blankets. 2. Hold a cup of water to your heart. 3. Whisper your needs into the water. 4. Drink it. 5. Say: 'I nourish myself.'"},
    "Aug 12, 2026": {s: "Leo", w: "Crown & Eclipse. New Moon in Leo. A Total Solar Eclipse. The king is dead, long live the king. A massive ego death and rebirth. The universe wants you to shine, but first you must drop the mask.", r: "1. Look in a mirror by candlelight. 2. Look into your own left eye. 3. Say 'I love you' 3 times. 4. Place a hand on your heart. 5. Say: 'I am the Queen of my life.'"},
    "Sep 11, 2026": {s: "Virgo", w: "Healer. New Moon in Virgo. The party of Leo is over; now we do the work. It is time to purify, organize, and heal. Set intentions for your daily routine. How you live your days is how you live your life.", r: "1. Cleanse your space with sage or sound. 2. Write a precise list of 3 goals. 3. Place a crystal on the list. 4. Commit to one small action today. 5. Say: 'I am focused and pure.'"},
    "Oct 10, 2026": {s: "Libra", w: "Mirror. New Moon in Libra. A new cycle for relationships. Balance is the key. Are you giving too much? Taking too much? Set intentions for harmony, beauty, and partnership. Invite peace into your heart.", r: "1. Light two white candles. 2. Tie a string between them loosely. 3. Visualize a relationship healing. 4. Cut the string to release old patterns. 5. Say: 'I am whole in myself.'"},
    "Nov 9, 2026": {s: "Scorpio", w: "Shadow. New Moon in Scorpio. The deepest moon of the year. We go underground. It is time to face what you fear and transform it into power. Plant seeds of transformation in the dark. Magic is potent tonight.", r: "1. Sit in total darkness. 2. Breathe into your pelvis/root. 3. Visualize a secret desire you are afraid to admit. 4. Claim it in the dark. 5. Say: 'I am not afraid of the dark.'"},
    "Dec 8, 2026": {s: "Sagittarius", w: "Arrow. New Moon in Sagittarius. The dark water of Scorpio finds a target. Aim high. This is the moon of freedom, expansion, and truth. What adventure is calling you? Set an intention that feels too big.", r: "1. Stand facing a direction you love. 2. Make a bow shape with your arms. 3. Visualize your intention as an arrow. 4. Release it with a breath. 5. Say: 'I fly free.'"}
  };

  const NEW_MOONS_ARRAY = ["Jan 18, 2026", "Feb 17, 2026", "Mar 18, 2026", "Apr 17, 2026", "May 16, 2026", "Jun 15, 2026", "Jul 14, 2026", "Aug 12, 2026", "Sep 11, 2026", "Oct 10, 2026", "Nov 9, 2026", "Dec 8, 2026"];

  const CELESTIAL_EVENTS = {
    "Feb 2": {n: "Imbolc Portal", d: "A sacred midpoint between Winter and Spring. The earth is stirring. Energy: Promise, Purification, First Light.", l: "spiritual meaning of imbolc"},
    "Aug 8": {n: "Lion's Gate Portal", d: "A massive alignment of Earth, Sirius, and the Sun. High-frequency light codes for ascension and bold manifestation.", l: "lions gate portal spiritual meaning"},
    "Nov 1": {n: "Samhain Portal", d: "The veil is thinnest. Ancestors are close. Energy: Commemorating the dead, Divination, Deep Roots.", l: "samhain spiritual significance"},
    "Feb 26": {n: "Mercury Retrograde Begins", d: "Communication turns inward. Do not fear; review. Energy: Reflection, Rewriting, Pausing.", l: "mercury retrograde spiritual meaning"},
    "Mar 20": {n: "Mercury Direct", d: "The shadow period clears. Move forward with the wisdom learned in the silence.", l: "mercury direct spiritual meaning"},
    "Jun 29": {n: "Mercury Retrograde Begins", d: "Thoughts turn nostalgic. Old friends may return. Energy: Reconnecting, Revisiting, Remembering.", l: "mercury retrograde in cancer spiritual meaning"},
    "Jul 23": {n: "Mercury Direct", d: "Direct motion returns. Proceed with the plans you reviewed.", l: "mercury direct july 2026"},
    "Oct 3": {n: "Venus Retrograde Begins", d: "Deep review of relationships, values, and finances. Energy: Re-evaluating the heart.", l: "venus retrograde 2026 spiritual meaning"},
    "Oct 24": {n: "Mercury Retrograde Begins", d: "Deep psychological review. Secrets are revealed for healing.", l: "mercury retrograde in scorpio spiritual meaning"},
    "Nov 12": {n: "Mercury Direct", d: "Clarity returns. Speak your truth.", l: "mercury direct november 2026"},
    "Nov 13": {n: "Venus Direct", d: "The heart opens again. Clarity in love and money.", l: "venus direct november 2026"},
    "Feb 17": {n: "Solar Eclipse", d: "A Ring of Fire. Major new beginnings.", l: "solar eclipse feb 2026 spiritual"},
    "Mar 3": {n: "Lunar Eclipse", d: "Total Lunar Eclipse. Blood Moon. Release.", l: "lunar eclipse march 2026 spiritual"},
    "Aug 12": {n: "Solar Eclipse", d: "Total Solar Eclipse. Destiny shifts.", l: "solar eclipse aug 2026 spiritual"},
    "Aug 28": {n: "Lunar Eclipse", d: "Partial Lunar Eclipse. Shadow work.", l: "lunar eclipse aug 2026 spiritual"}
  };

  const MOON_ANCHORS = [
    {d: new Date(2026, 0, 3), n: "Wolf Moon"}, {d: new Date(2027, 0, 22), n: "Wolf Moon"}
  ];

  const SHADOW_WORK = {
    "Aries": "Where am I afraid to be weak, and does my anger protect a deeper hurt?",
    "Taurus": "What comfort zone has become a cage? What am I hoarding out of fear?",
    "Gemini": "What truth am I silencing to keep the peace? Where is my mind distracting my heart?",
    "Cancer": "What old wound am I nurturing instead of healing? Where do I need to mother myself?",
    "Leo": "Where do I seek validation from others instead of myself? What part of my light am I hiding?",
    "Virgo": "Where does my perfectionism stop me from living? What mess am I afraid to make?",
    "Libra": "Where am I compromising my soul to please another? What imbalance am I ignoring?",
    "Scorpio": "What secret am I keeping from myself? What needs to die so I can be reborn?",
    "Sagittarius": "What am I running away from? Does my quest for freedom hurt those I love?",
    "Capricorn": "Where have I let ambition silence my intuition? What burden is not mine to carry?",
    "Aquarius": "Where do I detach to avoid feeling? Am I observing life instead of living it?",
    "Pisces": "What reality am I escaping? Where do I need boundaries to protect my energy?"
  };
  
  // V90: ACCURATE NEW MOONS FOR DAY 1 ANCHOR
  const REFERENCE_NEW_MOONS = [
    "Dec 19, 2025", "Jan 18, 2026", "Feb 17, 2026", "Mar 18, 2026", 
    "Apr 17, 2026", "May 16, 2026", "Jun 15, 2026", "Jul 14, 2026", 
    "Aug 12, 2026", "Sep 11, 2026", "Oct 10, 2026", "Nov 9, 2026", 
    "Dec 8, 2026", "Jan 6, 2027"
  ];

  function getDynamicContent(phase, zodiacSign, day) {
    try {
      if(!zodiacSign) return { whisper: "The stars are silent.", ritual: "Breathe." };
      const s = zodiacSign.split(' ')[0]; 
      const varIdx = day % 3; 
      let pKey = "Waxing";
      if (phase.includes("New")) pKey = "New";
      else if (phase.includes("Full")) pKey = "Full";
      else if (phase.includes("Waning") || phase.includes("Last")) pKey = "Waning";

      let whisper = `The moon in ${s} asks you to listen deeply today.`;
      let ritual = "Sit in silence and breathe.";
      if (DAILY_WISDOM_LIBRARY[s] && DAILY_WISDOM_LIBRARY[s][pKey]) {
        whisper = DAILY_WISDOM_LIBRARY[s][pKey][varIdx] || DAILY_WISDOM_LIBRARY[s][pKey][0];
      }
      if (DAILY_RITUALS[s]) {
        ritual = DAILY_RITUALS[s][varIdx] || DAILY_RITUALS[s][0];
      }
      return { whisper, ritual };
    } catch(err) { return { whisper: "Listen to your own heart.", ritual: "Light a candle." }; }
  }

  function getAffirmation(element) {
    const affirmations = { "FIRE": "I am the flame.", "EARTH": "I am the mountain.", "AIR": "I am the wind.", "WATER": "I am the river." };
    return affirmations[element] || "I am aligned.";
  }
  
  function openSearch(query) {
    if(query) {
      window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
    }
  }
  
  // V90: Strict Calculation - If day matches array, it IS Day 1.
  function getLunarDayAnchor(date) {
    const dTime = date.getTime();
    const dStrFull = date.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    
    // Exact match override
    if(NEW_MOONS_ARRAY.includes(dStrFull)) return 1;

    let lastNewMoonDate = null;
    
    // Find the most recent new moon that is <= current date
    for(let i = 0; i < REFERENCE_NEW_MOONS.length; i++) {
        const nm = new Date(REFERENCE_NEW_MOONS[i]);
        if (nm.getTime() <= dTime + 7200000) { // Add buffer
             lastNewMoonDate = nm;
        } else {
             break;
        }
    }
    
    if (lastNewMoonDate) {
         const oneDay = 1000 * 60 * 60 * 24;
         const d1 = new Date(lastNewMoonDate.getFullYear(), lastNewMoonDate.getMonth(), lastNewMoonDate.getDate());
         const d2 = new Date(date.getFullYear(), date.getMonth(), date.getDate());
         const exactDays = Math.round((d2 - d1) / oneDay);
         return exactDays + 1;
    }
    return null; 
  }

  function getCelestialData(date) {
    try {
      const dStrFull = date.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
      const dStrShort = date.toLocaleDateString('en-US', {month:'short', day:'numeric'});
      const jd = (date.getTime() / 86400000) + 2440587.5;
      const T = (jd - 2451545.0) / 36525;
      let moonLong = (218.316 + 481267.881 * T + 6.289 * Math.sin((135.27 + 477198.87 * T) * Math.PI / 180));
      moonLong = (moonLong + 5.0) % 360;
      if (moonLong < 0) moonLong += 360;
      
      const signs = ["Aries ‚ôà","Taurus ‚ôâ","Gemini ‚ôä","Cancer ‚ôã","Leo ‚ôå","Virgo ‚ôç","Libra ‚ôé","Scorpio ‚ôè","Sagittarius ‚ôê","Capricorn ‚ôë","Aquarius ‚ôí","Pisces ‚ôì"];
      const zodIndex = Math.floor(moonLong / 30);
      const zod = signs[zodIndex] || "Aries ‚ôà";
      const el = ZOD_ELEMENTS[zod] || "EARTH";
      
      let sunLong = (280.466 + 36000.770 * T) % 360;
      let angle = (moonLong - sunLong + 360) % 360;
      
      const sunSigns = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];
      const sunIndex = Math.floor(sunLong / 30);
      const sunZod = sunSigns[sunIndex] || "Aries";

      // EXACT DATE CHECK for Moon Phase
      let isFull = FULL_MOONS_ARRAY.some(m => m.d === dStrFull);
      let isNew = NEW_MOONS_ARRAY.includes(dStrFull);
      
      let pivotData = PIVOT_DATA[dStrShort];
      let isPivot = !!pivotData;
      let isEvent = CELESTIAL_EVENTS[dStrShort];

      let phase = "Waning Crescent", ico = "üåò";
      
      // Calculate Day
      let tDay = getLunarDayAnchor(date);
      if (!tDay) tDay = Math.floor((angle / 360) * 29.5) + 1;
      
      // V90: STRICT PHASE LOGIC (No Duplicate Full Moons)
      if (isNew) { phase = "New Moon"; ico = "üåë"; tDay = 1; }
      else if (isFull) { phase = "Full Moon"; ico = "üåï"; }
      else if (tDay >= 2 && tDay <= 7) { phase = "Waxing Crescent"; ico = "üåí"; }
      else if (tDay >= 8 && tDay <= 9) { phase = "First Quarter"; ico = "üåì"; }
      else if (tDay >= 10 && tDay <= 14) { phase = "Waxing Gibbous"; ico = "üåî"; } // Prevent range overlaps
      else if (tDay >= 15 && tDay <= 16) { 
        // IF it is day 15/16 but NOT the exact Full Moon date from array, call it Gibbous or Disseminating
        phase = "Waxing Gibbous"; ico = "üåî"; 
        if(tDay > 15.5) { phase = "Waning Gibbous"; ico = "üåñ"; }
      }
      else if (tDay >= 17 && tDay <= 21) { phase = "Waning Gibbous"; ico = "üåñ"; }
      else if (tDay >= 22 && tDay <= 23) { phase = "Last Quarter"; ico = "üåó"; }
      else if (tDay >= 24) { phase = "Waning Crescent"; ico = "üåò"; }

      let whisper, ritual, affirm;
      let fullMoonData = FULL_MOON_DATA[dStrFull];
      let newMoonData = NEW_MOON_DATA[dStrFull];

      if (isPivot) {
        whisper = pivotData.w;
        ritual = pivotData.r;
        affirm = "I am balanced. I am whole.";
      } else if (isFull && fullMoonData) {
        whisper = fullMoonData.w;
        ritual = fullMoonData.r;
        affirm = "I am illuminated.";
      } else if (isNew && newMoonData) {
        whisper = newMoonData.w;
        ritual = newMoonData.r;
        affirm = "I am new.";
      } else {
        let content = getDynamicContent(phase, zod, date.getDate());
        whisper = content.whisper;
        ritual = content.ritual;
        affirm = getAffirmation(el);
      }
      
      let shadow = "";
      if (isNew) {
        shadow = SHADOW_WORK[zod.split(' ')[0]] || "What is hidden?";
      }

      return { phase, ico, zod, sunZod, tDay, el, elColor: ELEMENTS[el], dStr: dStrShort, year: date.getFullYear(), isFull, isNew, isPivot: pivotData, isEvent, archetype: fullMoonData, whisper, ritual, shadow, affirm };
    } catch(e) {
      console.log("Celestial Calc Error", e);
      return { phase: "Moon", ico: "üåë", zod: "Aries ‚ôà", sunZod: "Aries", tDay: 1, el: "FIRE", elColor: "#fff", dStr: "", year: 2026, isFull:false, isNew:false, isPivot:false, isEvent:false, archetype:null, whisper:"Quiet.", ritual:"Breathe.", shadow:"", affirm:"" };
    }
  }

  function render() {
    const grid = document.getElementById("calendar"); 
    if(!grid) return;
    grid.innerHTML = "";
    document.getElementById("monthLabel").innerText = `${activeD.toLocaleString('default', { month: 'long' }).toUpperCase()} ${activeD.getFullYear()}`;
    ["M","T","W","T","F","S","S"].forEach(l => grid.innerHTML += `<div class="day-label">${l}</div>`);
    const first = new Date(activeD.getFullYear(), activeD.getMonth(), 1);
    const last = new Date(activeD.getFullYear(), activeD.getMonth() + 1, 0).getDate();
    let offset = (first.getDay() === 0) ? 6 : first.getDay() - 1;
    for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;
    
    const todayStr = new Date().toDateString();

    for(let i=1; i<=last; i++) {
      const d = new Date(activeD.getFullYear(), activeD.getMonth(), i);
      const data = getCelestialData(d);
      const cell = document.createElement("div");
      
      let classes = ['day'];
      if(d.toDateString() === selectedDate) classes.push('selected');
      if(d.toDateString() === todayStr) classes.push('today');
      if(data.isFull) classes.push('full-moon-day');
      if(data.isNew) classes.push('new-moon-day');
      if(data.isPivot || data.isEvent) classes.push('celestial-pivot');
      if(db.logs[d.toDateString()]) classes.push('period');
      
      cell.className = classes.join(' ');
      cell.innerHTML = `<span class="d-num">${i}</span><span class="t-num">${data.tDay}</span><span class="m-ico" style="filter: drop-shadow(0 0 5px ${data.elColor})">${data.ico}</span><span class="z-ico">${data.zod.split(' ')[0]}</span>`;
      cell.onclick = () => { selectedDate = d.toDateString(); updateDash(d); render(); };
      grid.appendChild(cell);
    }
  }

  function updateDash(date) {
    const data = getCelestialData(date);
    document.documentElement.style.setProperty('--aura', data.elColor);
    
    const titleText = data.archetype ? data.archetype.n.toUpperCase() : data.phase.toUpperCase();
    const displayTitle = `${titleText} ${data.ico}`;
    
    const titleEl = document.getElementById("dashTitle");
    titleEl.innerText = displayTitle; 
    titleEl.onclick = function() { openMasterModal(data); };
    
    document.getElementById("dashSub").innerText = `LUNAR DAY ${data.tDay} ‚Ä¢ ${data.dStr}, ${data.year}`;
    
    let eventHTML = "";
    
    if(data.isPivot && data.isPivot.n === "Spring Equinox") {
      eventHTML += `<div class="event-badge newyear-badge" onclick="openSearch('${data.isPivot.l}')">HAPPY ANCESTRAL NEW YEAR! üå∏</div><br>`;
    } else if(data.isPivot) {
      eventHTML += `<div class="event-badge portal-badge" onclick="openSearch('${data.isPivot.l}')">‚ú® ${data.isPivot.n.toUpperCase()}</div>`;
    }
    if(data.isEvent) {
       eventHTML += `<div class="event-badge retro-badge" onclick="openSearch('${data.isEvent.l}')">üëÅÔ∏è ${data.isEvent.n.toUpperCase()}</div>`;
    }
    
    document.getElementById("eventDisplay").innerHTML = eventHTML;
    document.getElementById("guidanceText").innerText = data.whisper;
    document.getElementById("ritualText").innerText = data.ritual;
    document.getElementById("affirmationText").innerText = data.affirm;
    
    if (data.isNew && data.shadow) {
      document.getElementById("shadowCard").style.display = "block";
      document.getElementById("shadowText").innerText = data.shadow;
    } else {
      document.getElementById("shadowCard").style.display = "none";
    }
    
    db.zodCache[date.toDateString()] = data.zod;
    localStorage.setItem('ancestral_moon_v89', JSON.stringify(db));
  }

  function openMasterModal(data) {
    const modal = document.getElementById("cosmicModal");
    const title = document.getElementById("modalTitle");
    const content = document.getElementById("modalContent");
    const overlay = document.querySelector(".modal-overlay");
    
    title.innerText = "COSMIC ALIGNMENT";
    
    const zodiacName = data.zod.split(' ')[0];
    const zodiacMeaning = ZODIAC_WISDOM[zodiacName] || "Trust the stars.";
    const phaseMeaning = PHASE_MEANINGS[data.phase] || "A time of transition.";
    const elementMeaning = ELEMENT_MEANINGS[data.el] || "Balance your energy.";
    const sunMeaning = SUN_SIGN_DATA[data.sunZod] || "The Season of Life.";
    
    let html = `
    <div class="modal-section">
      <span class="modal-label" style="color:var(--portal)">SUN IN ${data.sunZod.toUpperCase()} (THE SEASON)</span>
      <div class="modal-content-text">${sunMeaning}</div>
    </div>
    <div class="modal-section">
      <span class="modal-label">MOON IN ${data.zod.toUpperCase()} (THE MOOD)</span>
      <div class="modal-content-text">${zodiacMeaning}</div>
    </div>
    <div class="modal-section">
      <span class="modal-label">PHASE INTEL: ${data.phase.toUpperCase()}</span>
      <div class="modal-content-text">${phaseMeaning}</div>
    </div>
    <div class="modal-section" style="border-bottom:none;">
      <span class="modal-label" style="color:${data.elColor}">‚úß ${data.el} ENERGY ‚úß</span>
      <div class="modal-content-text">${elementMeaning}</div>
    </div>`;
    
    content.innerHTML = html;
    modal.style.display = "block";
    overlay.style.display = "block";
  }

  function closeModal() { document.getElementById("cosmicModal").style.display = "none"; document.querySelector(".modal-overlay").style.display = "none"; }

  function copySisterReport() {
    const d = new Date(selectedDate);
    const data = getCelestialData(d);
    let extra = data.isEvent ? `\nüåÄ Intel: ${data.isEvent.n}` : "";
    if (data.isPivot) extra = `\n‚ú® Portal: ${data.isPivot.n.n}`;
    let shadow = data.isNew ? `\nüåë Shadow Work: ${data.shadow}` : "";

    const report = `‚òæ Ancestral Moon Report: ${data.dStr}, ${data.year} ‚òΩ\nMoon: ${data.archetype ? data.archetype.n : data.phase}\nSign: ${data.zod} (${data.el})\n\nWhisper: ${document.getElementById("guidanceText").innerText}\n\nRitual: ${data.ritual}${shadow}${extra}\n\nSynced via The Ancestral Moon Map ‚ú®`;
    navigator.clipboard.writeText(report).then(() => alert("Report Copied!"));
  }

  function jumpToDate(dateStr) { selectedDate = dateStr; activeD = new Date(dateStr); render(); updateDash(activeD); showView('dash'); }
  function deleteEntry(dateStr) { if(confirm("Release this entry?")) { delete db.journals[dateStr]; delete db.logs[dateStr]; delete db.energy[dateStr]; localStorage.setItem('ancestral_moon_v89', JSON.stringify(db)); showView('grimoire'); } }

  function exportToCSV() {
    let csv = "Date,Moon Phase,Zodiac,Element,Flow,Energy,Journal Entry\n";
    const dates = Object.keys(db.journals).concat(Object.keys(db.logs), Object.keys(db.energy)).sort((a,b) => new Date(b) - new Date(a));
    const uniqueDates = [...new Set(dates)];
    
    uniqueDates.forEach(dStr => {
      const d = new Date(dStr);
      const celestial = getCelestialData(d);
      
      let flow = db.logs[dStr] ? "Yes" : "No";
      let energy = db.energy[dStr] ? db.energy[dStr].toUpperCase() : "N/A";
      let entry = db.journals[dStr] ? db.journals[dStr].replace(/(\r\n|\n|\r)/gm, " ").replace(/"/g, '""') : "";
      let phase = celestial.archetype ? celestial.archetype.n : celestial.phase;
      
      csv += `"${dStr}","${phase}","${celestial.zod}","${celestial.el}","${flow}","${energy}","${entry}"\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    link.setAttribute("href", url);
    link.setAttribute("download", "grimoire_export.csv");
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function showView(view) {
    document.getElementById('oracleDash').style.display = 'none';
    document.getElementById('grimoireView').style.display = 'none';
    document.getElementById('yearlyView').style.display = 'none';
    document.getElementById('libraryView').style.display = 'none';
    
    if(view === 'dash') document.getElementById('oracleDash').style.display = 'block';
    
    if(view === 'grimoire') {
      const g = document.getElementById('grimoireView'); g.style.display = 'block';
      const cont = document.getElementById('grimoireContent'); cont.innerHTML = "";
      const dates = Object.keys(db.journals).concat(Object.keys(db.logs), Object.keys(db.energy)).sort((a,b) => new Date(b) - new Date(a));
      [...new Set(dates)].forEach(d => {
        if(db.journals[d] || db.logs[d] || db.energy[d]) {
          let en = db.energy[d] ? (db.energy[d] === 'fire' ? 'üî•' : db.energy[d] === 'water' ? 'üíß' : db.energy[d] === 'air' ? 'üå¨Ô∏è' : 'ü™®') : '';
          cont.innerHTML += `<div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:15px; margin-bottom:10px; text-align:left; border-left:3px solid var(--aura);">
            <div style="font-size:0.6rem; color:var(--gold); display:flex; justify-content:space-between; margin-bottom:5px;"><span>${d} ‚Ä¢ ${db.zodCache[d] || 'Cosmos'}</span> <span>${en} ${db.logs[d] ? 'ü©∏' : ''}</span></div>
            <div style="font-family:'Charm'; font-size:1.1rem; color:#eee;">${db.journals[d] || "<i>Quiet.</i>"}</div>
            <div class="grim-actions"><button class="grim-btn" onclick="jumpToDate('${d}')">‚úèÔ∏è</button><button class="grim-btn" onclick="deleteEntry('${d}')">üóëÔ∏è</button></div>
          </div>`;
        }
      });
    }
    if(view === 'yearly') {
      document.getElementById('yearlyView').style.display = 'block';
      const yc = document.getElementById('yearlyContent'); yc.innerHTML = "";
      const currentYear = activeD.getFullYear();
      
      yc.innerHTML += `<h3 style="color:var(--gold); font-family:'Cinzel'; text-align:center;">${currentYear} CELESTIAL MAP</h3>`;
      
      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel'; margin-top:15px;">CELESTIAL PIVOTS</h4>`;
      
      let sortedPivots = [];
      for(let p in PIVOT_DATA) {
        if(p.includes("Equinox") || p.includes("Solstice") || PIVOT_DATA[p].n.includes("Equinox") || PIVOT_DATA[p].n.includes("Solstice")) {
             let d = new Date(`${p}, ${currentYear}`);
             sortedPivots.push({ date: d, key: p, name: PIVOT_DATA[p].n, link: PIVOT_DATA[p].l });
        }
      }
      sortedPivots.sort((a, b) => a.date - b.date);

      sortedPivots.forEach(item => {
         if(currentYear === 2027 && (item.key === "Sep 22" || item.key === "Dec 21")) return; 
         if(currentYear === 2026 && (item.key === "Sep 23" || item.key === "Dec 22")) return; 
         yc.innerHTML += `<div class="clickable-event" onclick="openSearch('${item.link}')" style="display:flex; justify-content:space-between; font-size:0.7rem; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0;"><span>‚ú® ${item.name} ‚Üó</span> <span>${item.key}</span></div>`;
      });
      
      for(let e in CELESTIAL_EVENTS) yc.innerHTML += `<div class="clickable-event" onclick="openSearch('${CELESTIAL_EVENTS[e].l}')" style="display:flex; justify-content:space-between; font-size:0.7rem; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0; color:var(--retro);"><span>üåÄ ${CELESTIAL_EVENTS[e].n} ‚Üó</span> <span>${e}</span></div>`;
      
      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel'; margin-top:20px;">13 FULL MOONS</h4>`;
      
      const yearFullMoons = FULL_MOONS_ARRAY.filter(m => m.d.includes(currentYear.toString()));
      yearFullMoons.forEach(m => {
        const arch = FULL_MOON_DATA[m.d] || {n:"Moon"};
        const displayDate = m.d.replace(`, ${currentYear}`, '');
        const query = `spiritual meaning of ${arch.n}`;
        yc.innerHTML += `<div class="clickable-event" onclick="openSearch('${query}')" style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0;"><span>üåï ${displayDate} - ${arch.n} ‚Üó</span> <span>${m.z}</span></div>`;
      });

      yc.innerHTML += `<h4 style="color:var(--gold); font-family:'Cinzel'; margin-top:20px;">13 NEW MOONS</h4>`;
      
      const yearNewMoons = NEW_MOONS_ARRAY.filter(d => d.includes(currentYear.toString()));
      
      yearNewMoons.forEach(dStrFull => {
        const d = new Date(dStrFull);
        const data = getCelestialData(d);
        const displayDate = dStrFull.replace(`, ${currentYear}`, '');
        const signName = data.zod.split(' ')[0];
        const query = `spiritual meaning of new moon in ${signName}`;
        yc.innerHTML += `<div class="clickable-event" onclick="openSearch('${query}')" style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:5px 0; color:var(--amethyst);"><span>üåë ${displayDate} - New Moon ‚Üó</span> <span>${data.zod}</span></div>`;
      });
      
      yc.innerHTML += `<div style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; font-size: 0.6rem; color: var(--gold); opacity: 0.7; text-align: center; font-style: italic;">This calendar follows the rhythm of the Rocky Mountains (MST). If you are on the coasts, your exact peak lunar moment may vary by a few hours, but the energy remains true.</div>`;
    }
    
    if(view === 'library') {
      const lib = document.getElementById('libraryView'); lib.style.display = 'block';
      const cont = document.getElementById('libraryContent');
      if(!cont.innerHTML) {
          let html = `<div class="lib-section"><span class="lib-title">SUN SIGNS (THE SEASONS)</span><div class="lib-grid">`;
          for(let s in SUN_SIGN_DATA) {
            const dates = SUN_SIGN_DATES[s] || "";
            html += `<a class="lib-btn" href="https://www.google.com/search?q=sun+in+${s}+spiritual+meaning" target="_blank">${s.toUpperCase()} <br><span style="font-size:0.6rem; opacity:0.7;">${dates}</span> ‚òÄÔ∏è</a>`;
          }
          html += `</div></div>`;
          
          html += `<div class="lib-section"><span class="lib-title">MOON SIGNS (THE MOOD)</span><div class="lib-grid">`;
          for(let z in ZODIAC_WISDOM) html += `<a class="lib-btn" href="https://www.google.com/search?q=moon+in+${z}+spiritual+meaning" target="_blank">${z.toUpperCase()} üåô</a>`;
          html += `</div></div>`;
          
          html += `<div class="lib-section"><span class="lib-title">PHASES OF CREATION</span><div class="lib-grid">`;
          for(let p in PHASE_MEANINGS) html += `<a class="lib-btn" href="https://www.google.com/search?q=${p}+moon+spiritual+meaning" target="_blank">${p.toUpperCase()}</a>`;
          html += `</div></div>`;
          
          html += `<div class="lib-section"><span class="lib-title">ELEMENTAL ENERGY</span><div class="lib-grid">`;
          for(let e in ELEMENT_MEANINGS) html += `<a class="lib-btn" href="https://www.google.com/search?q=${e.toLowerCase()}+element+spiritual+meaning" target="_blank">${e} ENERGY</a>`;
          html += `</div></div>`;
          
          cont.innerHTML = html;
      }
    }
  }

  function saveData() { db.journals[selectedDate] = document.getElementById("journalInput").value; localStorage.setItem('ancestral_moon_v89', JSON.stringify(db)); }
  function toggleFlow() { db.logs[selectedDate] = !db.logs[selectedDate]; localStorage.setItem('ancestral_moon_v89', JSON.stringify(db)); render(); updateDash(new Date(selectedDate)); }
  function changeMonth(n) { activeD.setMonth(activeD.getMonth() + n); render(); }

  const sField = document.getElementById('starField');
  for(let i=0; i<200; i++) {
    const s = document.createElement('div'); s.className = 'star';
    s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%';
    s.style.width = Math.random()*2+'px'; s.style.height = s.style.width; 
    s.style.setProperty('--d', (Math.random()*4+2)+'s'); sField.appendChild(s);
  }

  render(); updateDash(new Date());
</script>
</body>
</html>
